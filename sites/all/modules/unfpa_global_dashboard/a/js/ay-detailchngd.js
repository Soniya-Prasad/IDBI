/**
 * @file
 */

var chartMapConfigXMLNodeObj = {"map_area_indicator_data":
          {
            "perc_girl_age_20_24_mrd_bfr_18": "Percentage of women aged 20-24 who got married before age 18",
            "perc_girl_age_20_24_mrd_bfr_15": "Percentage of women aged 20-24 who got married before age 15",
            "perc_girl_age_20_24_gave_birth_bfr_18": "Percentage of women aged 20-24 who gave birth before age 18",
            "perc_girl_age_20_24_gave_birth_bfr_15": "Percentage of women aged 20-24 who gave birth before age 15",
            "perc_mrd_girl_age_15_19_using_contrcptn_mthd": "Percentage of currently married/in union females aged 15-19 who are currently using any contraceptive method",
            "perc_mrd_girl_age_15_19_using_mdrn_contrcptn_mthd": "Percentage of currently married/in union females aged 15-19 who are currently using any modern contraceptive method",
            "perc_mrd_girl_age_15_19_not_using_contrcptn_mthd": "Percentage of currently married/in union females aged 15-19 who are not currently using any contraceptive method",
            "perc_mrd_girl_age_15_19_hv_unmet_need_fml_pln": "Percentage of currently married/in union females aged 15-19 who have an unmet need for family planning",
            "perc_mrd_girl_age_15_19_contrcptn_dmnd_stsfd": "Percentage of currently married/in union females aged 15-19 who have their contraception demand satisfied",
            "perc_mrd_girl_age_20_24_using_contrcptn_mthd": "Percentage of currently married/in union females aged 20-24 who are currently using any contraceptive method",
            "perc_mrd_girl_age_20_24_using_mdrn_contrcptn_mthd": "Percentage of currently married/in union females aged 20-24 who are currently using any modern contraceptive method",
            "perc_mrd_girl_age_20_24_not_using_contrcptn_mthd": "Percentage of currently married/in union females aged 20-24 who are not currently using any contraceptive method",
            "perc_mrd_girl_age_20_24_hv_unmet_need_fml_pln": "Percentage of currently married/in union females aged 20-24 who have an unmet need for family planning",
            "perc_mrd_girl_age_20_24_contrcptn_dmnd_stsfd": "Percentage of currently married/in union females aged 20-24 who have their contraception demand satisfied",
            "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd": "Proportion of women 15-19 involved in decision making for contraceptive use",
            "perc_girl_age_20_24_take_contrcptn_desc_byself_or_with_hsbnd": "Proportion of women 20-24 involved in decision making for contraceptive use",
            "perc_girl_age_15_19_take_own_hlth_desc_byself_or_with_hsbnd": "Proportion of women 15-19 involved in decision making for own health care",
            "perc_girl_age_20_24_take_own_hlth_desc_byself_or_with_hsbnd": "Proportion of women 20-24 involved in decision making for own health care",
            "perc_girl_age_15_19_have_knwldg_hiv_aids": "Percentage of females aged 15-19 who have comprehensive Knowledge of HIV/AIDS",
            "perc_girl_age_20_24_have_knwldg_hiv_aids": "Percentage of females aged 20-24 who have comprehensive Knowledge of HIV/AIDS",
            "perc_female_ever_had_all_girl_15_19": "Percentage of girls aged 15-19 who  ever had sex",
            "perc_female_sexuly_active_all_girl_15_19": "Percentage of girls aged 15-19 who are sexually active",
            "perc_wife_think_beating_jusfd_girl_15_24": "Percentage of females aged 15-24 who think that wife beating is justified under at least one condition",
            "perc_15_24_age_diff_btwn_female_and_partnr_girl_10_or_more": "Percentage of females aged 15-24 who have a  husband/cohabiting partner 10 or more years older"
          },
  "table_ppl_dstrbtn_resd_regn_tabledata": "by_ppl_dstrbtn_resd_regn_tabledata",
  "graph_ppl_dstrbtn_resd_regn":
          {
            "girl_10_14": "by_ppl_dstrbtn_resd_regn_girl_10_14",
            "girl_15_19": "by_ppl_dstrbtn_resd_regn_girl_15_19",
            "girl_20_24": "by_ppl_dstrbtn_resd_regn_girl_20_24",
            "boy_10_14": "by_ppl_dstrbtn_resd_regn_boy_10_14",
            "boy_15_19": "by_ppl_dstrbtn_resd_regn_boy_15_19",
            "boy_20_24": "by_ppl_dstrbtn_resd_regn_boy_20_24"
          },
  "graph_part_resd_household_adolescnt":
          {
            "girl_10_14": "by_part_resd_household_adolescnt_girl_10_14",
            "boy_10_14": "by_part_resd_household_adolescnt_boy_10_14"
          },
  "graph_mrtl_status_adolescnt":
          {
            "girl_15_19": "by_mrtl_status_adolescnt_girl_15_19",
            "girl_20_24": "by_mrtl_status_adolescnt_girl_20_24"
          },
  "graph_schl_atnd_adolescnt_female":
          {
            "girl_10_14": "by_schl_atnd_adolescnt_female_girl_10_14",
            "girl_15_19": "by_schl_atnd_adolescnt_female_girl_15_19"
          },
  "graph_schl_atnd_adolescnt_male":
          {
            "boy_10_14": "by_schl_atnd_adolescnt_male_boy_10_14",
            "boy_15_19": "by_schl_atnd_adolescnt_male_boy_15_19"
          },
  "graph_adolescnt_mrg": "by_adolescnt_mrg",
  "graph_adolescnt_prg": "by_adolescnt_prg",
  "graph_perc_mrd_female_used_or_not_contrcptn":
          {
            "girl_15_19": "by_perc_mrd_female_used_or_not_contrcptn_girl_15_19",
            "girl_20_24": "by_perc_mrd_female_used_or_not_contrcptn_girl_20_24"
          },
  "graph_perc_female_contrcptn_dmnd_unmet": "by_perc_female_contrcptn_dmnd_unmet_girl_15_24",
  "graph_perc_female_contrcptn_dmnd_met": "by_perc_female_contrcptn_dmnd_met_girl_15_24",
  "graph_perc_female_sexuly_active":
          {
            "all_girl_15_19": "by_perc_female_sexuly_active_all_girl_15_19",
            "never-married_girl_15_19": "by_perc_female_sexuly_active_never-married_girl_15_19",
          },
  "graph_perc_age_diff_btwn_female_and_partnr": "by_perc_age_diff_btwn_female_and_partnr_girl_15_24",
  "graph_perc_wife_think_beating_jusfd": "by_perc_wife_think_beating_jusfd_girl_15_24",
  "graph_perc_female_take_contrcptn_desc_byself_or_with_hsbnd": "by_perc_female_take_contrcptn_desc_byself_or_with_hsbnd_girl_15_24",
  "graph_perc_female_have_knwldg_hiv_aids": "by_perc_female_have_knwldg_hiv_aids_girl_15_24"
};
// Array of indicators lies in the category where loe is good.
var IndLowerIsGood =
        {
          "perc_mrd_girl_age_15_19_using_contrcptn_mthd": "perc_mrd_girl_age_15_19_using_contrcptn_mthd",
          "perc_mrd_girl_age_15_19_using_mdrn_contrcptn_mthd": "perc_mrd_girl_age_15_19_using_mdrn_contrcptn_mthd",
          "perc_mrd_girl_age_20_24_using_contrcptn_mthd": "perc_mrd_girl_age_20_24_using_contrcptn_mthd",
          "perc_mrd_girl_age_20_24_using_mdrn_contrcptn_mthd": "perc_mrd_girl_age_20_24_using_mdrn_contrcptn_mthd",
          "perc_mrd_girl_age_15_19_contrcptn_dmnd_stsfd": "perc_mrd_girl_age_15_19_contrcptn_dmnd_stsfd",
          "perc_mrd_girl_age_20_24_contrcptn_dmnd_stsfd": "perc_mrd_girl_age_20_24_contrcptn_dmnd_stsfd",
          "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd": "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd",
          "perc_girl_age_20_24_take_contrcptn_desc_byself_or_with_hsbnd": "perc_girl_age_20_24_take_contrcptn_desc_byself_or_with_hsbnd",
          "perc_girl_age_15_19_take_own_hlth_desc_byself_or_with_hsbnd": "perc_girl_age_15_19_take_own_hlth_desc_byself_or_with_hsbnd",
          "perc_girl_age_20_24_take_own_hlth_desc_byself_or_with_hsbnd": "perc_girl_age_20_24_take_own_hlth_desc_byself_or_with_hsbnd",
          "perc_girl_age_15_19_have_knwldg_hiv_aids": "perc_girl_age_15_19_have_knwldg_hiv_aids",
          "perc_girl_age_20_24_have_knwldg_hiv_aids": "perc_girl_age_20_24_have_knwldg_hiv_aids"
        }
// Get pie chart div.
var PIE_CHART_DIV_1 = 'graph_ppl_dstrbtn_resd_regn';
var MAP_DIV = 'map_area_indicator_data';
// Set deafut map indicator.
var DEFULT_MAP_INDCTR = 'perc_girl_age_20_24_mrd_bfr_18';
// First time map loader flag.
var mapLoadedFlg = false;
// Full screen flag.
var IconImgFlag = false;

// Get graph type.
var MAP_TYPE = 'map';
// Get graph type.
var GRAPH_TYPE = 'graph';
// Get graph type.
var TBL_TYPE = 'table';
var CHART_TITLE_FONTSIZE = 12;
// Var CHART_LABEL_COLOR = '#000000';.
var TOOLTIP_FONTSIZE = '11px';
var XAXIS_FONTSIZE = '9px';
var YAXIS_FONTSIZE = '9px';
var SERIES_ITEM_FONTSIZE = '9px';
var LEGENDITEM_FONTSIZE = '10px';
var LEGENDITEM_SYMBOL_PADDING = 2;
var LEGENDITEM_SYMBOL_WIDTH = 10;
var CHART_LABEL_FONTSIZE = '11px';
var CHART_LABEL_COLOR = '#000000';
var CHART_FONT_FAMILY = 'Verdana';
var graph_perc_female_sexuly_active_married_girl_15_19 = false;
var graph_perc_female_sexuly_active_all_girl_15_19 = false;
var graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19 = false;
var graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24 = false;
var mapLoadedFlg = false;
var filexistAreaIdStatus = "";
var EXPORT_MENU = '<div class="grapTypesMenu rnded_crnrs smlBox"><a href="javascript:void(\'0\');" class="export" type="pdf">PDF</a><br><a class="export" type="png" href="javascript:void(\'0\');">PNG</a><br><a class="export" href="javascript:void(\'0\');" type="jpeg" >JPEG</a><br><a class="export" href="javascript:void(\'0\');" type="svg" >SVG</a></div>';
var MAPS_API_URL = "http://admin.unfpaopendata.org/api/data?db=2&map=true&area=";
var country_code = "";
(function ($) {

  Drupal.behaviors.cc = {
    attach: function (context, settings) {
      allareaLevel5 = Drupal.settings.allareaLevel5;
      country_code = Drupal.settings.country_code;
    }
  };

  $(document).ready(function () {

    SERVER_NAME = window.location.host;

    SEL_AREA_ID = country_code;
    $('a[rel="' + SEL_AREA_ID + '"]').addClass('selected');
    // --------------------------- json data start --------
    // console.log("basepath");
    // console.log(Drupal.settings.basePath);.
    var country_path = Drupal.settings.basePath + "jsondata/" + country_code;
    var request = new XMLHttpRequest();
    request.open("GET", country_path, false);
    request.send(null);
    var AREA_JSON_DATA_OBJ = JSON.parse(request.responseText);
    // console.log(AREA_JSON_DATA_OBJ);
    // --------------------------- json data end --------
    // --------------------indicator start.
    option_html = '';
    $.each(chartMapConfigXMLNodeObj["map_area_indicator_data"], function (node, name) {
      // we cant change below because what will happen when no file exists

      if (AREA_JSON_DATA_OBJ["by_map_area_indicator_data"][node]['seriesData'] != "")
      {
        mapLoadedFlg = true;
        //console.log("node-->"+ node + "  name-->"+ name)
        chckMapDataFlg = true;
        $('#slctindi_id').append($('<option>', {
          value: node,
          text: name
        }));
        option_html += '<option value="' + node + '">' + name + '</option>';
        // console.log(node, name);.
      }

    });

    //Pie chart filter label
    $('#sel_ppl_dstrbtn_resd_regn_radio label').click(function () {
      $(this).siblings().children('.iCheck-helper').attr("checked", true).trigger("click");
    });

    //Pie chart filter radio btn
    $('#sel_ppl_dstrbtn_resd_regn_radio .iCheck-helper').click(function () {
      piechart_filter = $(this).siblings().val();
      makePieChart('graph_ppl_dstrbtn_resd_regn', piechart_filter);
    });

    $('.graph').click(function () {
      $(this).siblings().removeClass('active');
      $(this).addClass('active');
      $(this).parent().siblings().find('.square-input-element').css('display', 'none');
      $(this).siblings('.table').addClass("graph_table");
      $(this).addClass("active");
      $(this).parents('.country-chart-section-left').siblings('.country-chart-section-right').find('#map_render').css('display', 'none');
      graph_class = '.' + $(this).prop('id');
      $(graph_class).css('display', 'block');
    });

    $('.map').click(function () {
      $(this).siblings().removeClass('active');
      $(this).addClass('active');
      $(this).parent().siblings().find('.square-input-element').css('display', 'block');
      $(this).siblings('.table').removeClass("graph_table");
      $(this).siblings('.table').addClass("map_table");
      $(this).parents('.country-chart-section-left').siblings('.country-chart-section-right').find('#map_render').css('display', 'block');
      $(this).parents('.dashboard-country-outer-box').find('.bar_chart').css('display', 'none');
    });

    $('.map_table').click(function () {
      $(this).siblings().removeClass('active');
      $(this).addClass('active');
      if ($(this).hasClass("graph_table")) {
        class_bar_chart_table = '.' + $(this).prop('id');
        var visDivID = containerParentDivID = null;
        window[visDivID] = null;
        visDivID = $(class_bar_chart_table).attr('id');
        containerParentDivID = $(class_bar_chart_table).parent("div").attr('id');
        //console.log(containerParentDivID+'  '+visDivID);
        var objType = 'chart';

        /*if(visDivID=='mapDivId'){
         objType = 'map';
         } else {
         chartTitle ='test';		//mainObj[visDivID].chartTitle;
         }*/
        // get chart object
        var obj = jQuery.extend(true, {}, window[visDivID]);
        objTblSettings = {title: {enabled: false}};
        calledSec = 'hosting';

        //console.log(containerParentDivID);
        if (!$('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).length)
        {
          //call function to get object data in tabular format
          tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);

          $('#' + containerParentDivID).append(tblContent);
          $('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).hide();

          if ($('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).css('display') == 'none') {

            $('#' + visDivID).slideToggle("slow");
            $('#' + containerParentDivID + ' div.dfapi-visTbl-container').slideToggle("slow");
          } else
          {
            $('#' + containerParentDivID + ' div.dfapi-visTbl-container').slideToggle("slow");
            $('#' + visDivID).slideToggle("slow");
          }
        } else {
          //call function to get object data in tabular format
          tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);

          $('#' + containerParentDivID).append(tblContent);

          if ($('#' + visDivID).css('display') == 'none') {
            $('#' + visDivID).slideToggle("slow");
            $('#' + containerParentDivID + ' div.dfapi-visTbl-container').hide();
          } else
          {
            $('#' + containerParentDivID + ' div.dfapi-visTbl-container').show();
            $('#' + visDivID).slideToggle("slow");
          }
        }

        // call function to enable sorting of table
        dfa_tableview.enableTableSorting(containerParentDivID);

      } else
      {

        var visDivID = containerParentDivID = null;
        window[visDivID] = null;
        // get chart parent container div id
        //var containerParentDivID = $(this).parent().next('div').attr('id');
        // get chart container div id
        //visDivID = 'map_area_indicator_data';
        debugger;
        visDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        mapdivid = '#' + $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        containerParentDivID = 'map_render';
        // visualization object type
        //var objType = 'chart'; //$(this).closest('div.bigdiv').children().find('div').attr('class');
        if (visDivID == $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id')) {
          objType = 'map';
        } else {
          chartTitle = 'test';		//mainObj[visDivID].chartTitle;
        }

        // get chart object
        var obj = window[visDivID];

        //console.log ("Chart Container: " + visDivID + "\nChart Container Parent: " + containerParentDivID+'  objType-->'+objType);

        if (!$('#map_render').find($('div.dfapi-visTbl-container')).length)
        {
          objTblSettings = {title: {enabled: false}};
          calledSec = 'hosting';
          //call function to get object data in tabular format
          debugger;
          tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);
          //alert(tblContent);
          $('#map_render').append(tblContent);
          //$('#mapDivId').hide();
          $('#map_render').find($('div.dfapi-visTbl-container')).hide();
        }
        if ($('#map_render').find($('div.dfapi-visTbl-container')).css('display') == 'none') {
          $('#map_area_indicator_data').slideToggle("slow");
          $('#map_render div.dfapi-visTbl-container').slideToggle("slow");
          $('.dfapi_hcnav_medium_con').hide();


        } else
        {
          $('#map_render div.dfapi-visTbl-container').slideToggle("slow");
          $('#map_area_indicator_data').slideToggle("slow");
          $('.dfapi_hcnav_medium_con').show();
        }

        // call function to enable sorting of table
        dfa_tableview.enableTableSorting(containerParentDivID);
      }

    });

    $('.dashboard-country-outer-box label').click(function () {
      $(this).siblings().children('.iCheck-helper').attr("checked", true).trigger("click");
    });

    $('.dashboard-country-outer-box .iCheck-helper').click(function () {
      if (($(this).parent().parent().parent().prop('className')) != 'filter-option') {
        //graph button
        $('#map_render').css('display', 'block');
        $('.bar_chart').css('display', 'none');
        id_for_chart_button = 'graph_' + $(this).siblings().prop('className');
        chart_button_parent = '.' + $(this).parent().parent().parent().parent().parent().prop('id');
        console.log($(chart_button_parent).find('.graph').prop('className'));
        $(chart_button_parent).find('.graph').prop('id', id_for_chart_button);

        //Filter
        if (($(this).parent().parent().prop('className')) != 'filter-option') {
          $('.square-input-element').css('display', 'none');
        }

        filter_id = '#' + ($(this).siblings().prop("className"));
        $(filter_id).css('display', 'block');

        //graph table id add
        generate_id_fr_graph_btn_bar_table = 'table_' + $(this).siblings().prop('className');
        $('.table').prop('id', generate_id_fr_graph_btn_bar_table);

      }




      if (mapLoadedFlg)	//if map has been loaded properly
      {

        // if selected parent container already contain visualization table content
        if ($('#map_render').find($('div.dfapi-visTbl-container')).length)
        {
          $('#map_render').find($('div.dfapi-visTbl-container')).remove();
          $('#map_area_indicator_data').css("display", "block");
          ;
        }



//        var mapIndctData = $('#slctindi_id').data('ddslick');
//
//        selOpt = mapIndctData.selectedData.value;
        selOpt = $(this).siblings().val();
        console.log("check here");
        console.log(selOpt);
        //console.log('11 sell');
        //console.log('mapData onchage 346');
        //call function to change map data
        ChangeLegend(selOpt);
        if (filexistAreaIdStatus == true) {
          var mapData = getMapData();
        } else
        {
          var mapData = getApidata(selOpt);
        }
        div_var = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        loadHCMapData(mapGeojson, mapData, div_var);

      }
      //alert(' sel txt--->'+sData.selectedData.text+' sel index--->'+sData.selectedData.value);
      mapLoadedFlg = true;

    });




    // when 'School Attendance among Adolescents aged 10-19 (Girls)' select box changes
    $('#sel_schl_atnd_adolescnt_female').ddslick({
      width: 130,
      onSelected: function (sData) {
        //call function to make Bar Chart
        makeBarChart('graph_schl_atnd_adolescnt_female', sData.selectedData.value);
      }
    });

    $(document).on('change', "#slctindi_id5", function (el) {
      makeBarChart('graph_schl_atnd_adolescnt_female', $(el.target).val());
    });

    // when 'School Attendance among Adolescents aged 10-19 (Boys)' select box changes
    $('#sel_schl_atnd_adolescnt_male').ddslick({
      width: 130,
      onSelected: function (sData) {
        //call function to make Bar Chart
        makeBarChart('graph_schl_atnd_adolescnt_male', sData.selectedData.value);
      }
    });

    $(document).on('change', "#slctindi_id6", function (el) {
      makeBarChart('graph_schl_atnd_adolescnt_male', $(el.target).val());
    });

    //when 'Parental Residence in Household among Adolescents aged 10-14' select box change
    $('#sel_part_resd_household_adolescnt').ddslick({
      width: 100,
      onSelected: function (sData) {
        //call function to make Bar Chart
        makeBarChart('graph_part_resd_household_adolescnt', sData.selectedData.value);
      }
    });

    $(document).on('change', "#slctindi_id3", function (el) {
      makeBarChart('graph_part_resd_household_adolescnt', $(el.target).val());
    });

    //when 'Marital Status among Adolescent Girls aged 15-24' select box change
    $('#sel_mrtl_status_adolescnt').ddslick({
      width: 130,
      onSelected: function (sData) {


        //call function to make Bar Chart
        makeBarChart('graph_mrtl_status_adolescnt', sData.selectedData.value);
      }
    });

//    $(document).on('change', "#slctindi_id4", function (el) {
//      makeBarChart('graph_mrtl_status_adolescnt', $(el.target).val());
//    });

    //when 'Family Planning' select box change
    $('#sel_perc_mrd_female_used_or_not_contrcptn').ddslick({
      width: 130,
      onSelected: function (sData) {

        //call function to make Bar Chart
        makeBarChart('graph_perc_mrd_female_used_or_not_contrcptn', sData.selectedData.value);
      }
    });

    $(document).on('change', "#slctindi_id8", function (el) {
      makeBarChart('graph_perc_mrd_female_used_or_not_contrcptn', $(el.target).val());
    });

    //when 'Sexual Activity and Age Difference between Couples' select box change
    $('#sel_perc_female_sexuly_active').ddslick({
      width: 330,
      onSelected: function (sData) {
        //call function to make Bar Chart
        makeBarChart('graph_perc_female_sexuly_active', sData.selectedData.value);
        //if bar chart data found properly
        if (barChartData !== undefined && barChartData != '' && barChartData != null)
        {
          $('#title_div').html(barChartData.chartTitle);
        }
      }
    });

    $(document).on('change', "#slctindi_id7", function (el) {
      makeBarChart('graph_perc_female_sexuly_active', $(el.target).val());

      //if bar chart data found properly
      if (barChartData !== undefined && barChartData != '' && barChartData != null)
      {
        $('#title_div').html(barChartData.chartTitle);
      }
    });



    //click events of zoom in, zoom out and full extend
    $('.dfapi_hcnav_medium_con .dfapi_hcnav_big').on('click', function () {

      var hcmapobj = window['map_area_indicator_data'];
      if ($(this).hasClass('zoomin')) {
        hcmapobj.mapZoom(0.5); // Zoom In
      } else if ($(this).hasClass('zoomout')) {
        hcmapobj.mapZoom(2); // Zoom Out
      } else if ($(this).hasClass('fulextend')) {
        hcmapobj.mapZoom(); // full extend
      }
    });

//click events of table data
    $('.dfapi-viz-toolbar .dfapi-viz-toolbar-medium').on('click', function () {

      if ($(this).hasClass('print'))
      {
        var containerParentDivID = 'map_render';

        // get chart container div id
        var visDivID = 'map_area_indicator_data';

        // visualization object type
        var objType = 'map';

        //alert ("Chart Container: " + visDivID + "\nChart Container Parent: " + containerParentDivID+'  objType-->'+objType);
        dfa_printvisualization.print(objType, containerParentDivID);

      }


    });

    $('.dwnld-opts a').on('click', function () {

      // get chart container div id
      var visDivID = 'map_area_indicator_data';

      // visualization object type
      var objType = 'map';

      // get visualization object
      var obj = window[visDivID];

      //Chart Title
      var chartTitle = '';
      var subtitle = $('#country_name h3').text();


      if (visDivID == 'map_area_indicator_data')
      {
        objType = 'map';
        chartTitle = 'Prevalence of Female Genital Mutilation (FGM) among Women Aged 15-49';
      }


      // different file format (png, jpeg, svg and pdf) can be used
      //var fileType = typeVal;
      var fileType = this.type;
      // name of file to be used while downloading
      var selVisFileName = 'chart';

      // apply visualization additional settings like title, subtile before to download
      objDwnldSettings = {};

      //chartSubtitle = chartSubtitle.replace(/[<br/>]/g, ' ');

      if (objType == 'chart')
      {
        objDwnldSettings = {title: {text: chartTitle, style: {'font-size': '11px', 'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif', 'color': '#3C3C3C', 'fontWeight': 'bold'}, subtitle: {enabled: false}}};
      } else if (objType == 'map')
      {
        selVisFileName = 'map';
        objDwnldSettings = {
          'title': {
            'text': 'Prevalence of Female Genital Mutilation (FGM) among Women Aged 15-49',
            'style': {
              'font-size': '12px',
              'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
              'fill': '#3C3C3C',
              'color': '#3C3C3C',
              'fontWeight': 'bold'
            }
          },
          'subtitle': {
            'text': subtitle,
            'style': {
              'font-size': '12px',
              'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
              'fill': '#3C3C3C',
              'color': '#3C3C3C',
              'fontWeight': 'bold'
            }
          }
        };
      }

      dfa_dwnldvisualization.download(objType, obj, selVisFileName, fileType, objDwnldSettings);
    });

    // Print Chart starts
    $('a.icon_one').on('click', function () {
      if (IconImgFlag == false)					//When full screen is off.
      {
        var chartID = $(this).parent("div").parent("div").next('div[id^="graph_"]').attr('id');

      } else {

        var chartID = $(this).parent("div").siblings('div[id^="graph_"]').attr('id');
      }
      // visualization object type
      var objType = 'chart';
      // get chart container div id
      var visDivID = chartID;
      var containerParentDivID = $('#' + chartID).parent().attr('id');
      dfa_printvisualization.print(objType, containerParentDivID);

    });   //ends print charts


    //Show and Hide table on table icon click
    $('a.icon_three').on('click', function () {
      var visDivID = containerParentDivID = null;
      window[visDivID] = null;
      visDivID = $(this).parent("div").parent("div").next('div[id^="graph_"]').attr('id');
      containerParentDivID = $(this).parent("div").parent("div").parent("div").attr('id');
      //console.log(containerParentDivID+'  '+visDivID);
      var objType = 'chart';

      /*if(visDivID=='mapDivId'){
       objType = 'map';
       } else {
       chartTitle ='test';		//mainObj[visDivID].chartTitle;
       }*/
      // get chart object
      var obj = jQuery.extend(true, {}, window[visDivID]);
      objTblSettings = {title: {enabled: false}};
      calledSec = 'hosting';

      //console.log(containerParentDivID);
      if (!$('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).length)
      {
        //call function to get object data in tabular format
        tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);

        $('#' + containerParentDivID).append(tblContent);
        $('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).hide();

        if ($('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).css('display') == 'none') {

          $('#' + visDivID).slideToggle("slow");
          $('#' + containerParentDivID + ' div.dfapi-visTbl-container').slideToggle("slow");
        } else
        {
          $('#' + containerParentDivID + ' div.dfapi-visTbl-container').slideToggle("slow");
          $('#' + visDivID).slideToggle("slow");
        }
      } else {
        //call function to get object data in tabular format
        tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);

        $('#' + containerParentDivID).append(tblContent);

        if ($('#' + visDivID).css('display') == 'none') {
          $('#' + visDivID).slideToggle("slow");
          $('#' + containerParentDivID + ' div.dfapi-visTbl-container').hide();
        } else
        {
          $('#' + containerParentDivID + ' div.dfapi-visTbl-container').show();
          $('#' + visDivID).slideToggle("slow");
        }
      }

      // call function to enable sorting of table
      dfa_tableview.enableTableSorting(containerParentDivID);

    });

    $('a.icon_two').append(EXPORT_MENU);
//Export  Chart PNG,JPEG, PDF
    $('a.icon_two').find('a.export').on('click', function () {

      if (IconImgFlag == false)					//When full screen is off.
      {
        var chartID = $(this).parent("div").parent().parent('div').parent('div').next('div[id^="graph_"]').attr('id');

      } else {

        var chartID = $(this).parent("div").parent('a').parent("div").siblings('div[id^="graph_"]').attr('id');
      }
      var containerParentDivID = $('#' + chartID).parent().attr('id');

      switch (containerParentDivID)
      {
        case 'p-VO_1':
          chartTitle = "Population Distribution, by Residence and Region";
          break;
        case 'p-VO_2':
          chartTitle = "Parental Residence in Household among Adolescents aged 10-14";
          break;
        case 'p-VO_3':
          chartTitle = "Marital Status among Adolescent Girls aged 15-24";
          break;
        case 'p-VO_4':
          chartTitle = "Marital Status among Adolescent Girls aged 15-24";
          break;
        case 'p-VO_5':
          chartTitle = "School Attendance among Adolescents aged 10-19";
          break;
        case 'p-VO_6':
          chartTitle = "Marital Status among Adolescent Girls aged 15-24";
          break;
        case 'p-VO_7':
          chartTitle = "School Attendance among Adolescents aged 10-19";
          break;
        case 'p-VO_8':
          chartTitle = "Percentage of women aged 20-24 who got married before age 18/15";
          break;
        case 'p-VO_9':
          chartTitle = "Percentage of women aged 20-24 who gave birth before age 18/15";
          break;
        case 'p-VO_10':
          chartTitle = " Percentage of currently married/in union females who currently using/not currently using contraception";
          break;
        case 'p-VO_11':
          chartTitle = "Percentage of currently married/in union females aged 15-24 who have an unmet need for family planning";
          break;
        case 'p-VO_12':
          chartTitle = "Percentage of currently married/in union females aged 15-24 who have their contraception demand satisfied";
          break;
        case 'p-VO_13':
          chartTitle = "Sexual activity among never-married 15-19 year old girls (percent)";
          break;
        case 'p-VO_14':
          chartTitle = "Age difference between women and current husband/cohabiting partner, among female aged 15-24 (percent)";
          break;
        case 'p-VO_15':
          chartTitle = " Percentage of 15-24 year old females who think that wife beating is justified under at least one condition";
          break;
        case 'p-VO_16':
          chartTitle = "Percentage of currently married women age 15-24 who usually make decisions regarding contraceptive use either by themselves or jointly with their husbands";
          break;
        case 'p-VO_17':
          chartTitle = "Percentage of females aged 15-24 who have comprehensive Knowledge of HIV/AIDS";
          break;
      }

      var type = $(this).attr('type');
      var chartDiv = $(chartID);
      var graphObj = window[chartID];
      var selOptData = [];
      /////////////////////////////////////////
      selOptId = chartID.replace("graph_", "sel_");
      selGraphOpt = '';
      if ($('#' + selOptId).length)
      {
        ddData = $('#' + selOptId).data('ddslick');
        selGraphOpt = ddData.selectedData.value;
      }
      ////////////////////////////////////////////

      /*var chartXMLNode = getChartXMLDataNode(chartID, selGraphOpt, GRAPH_TYPE);
       //console.log(chartXMLNode.chartTitle.toSource());

       //chart tile for jpeg, png downloads
       var chartTitle = chartXMLNode.chartTitle*/

      var subgp = $('#' + chartID).parent().parent().find('.dd-selected-text').html();
      if ($.trim(subgp) !== '')
      {
        var chartTitle = chartTitle + ' ,' + subgp;
      }
      //$('.dd-selected').find('.dd-selected-text').html()
      // reverse categories
      var catRev = ($.trim(graphObj.series[0].chart.xAxis[0].reversed)) ? graphObj.series[0].chart.xAxis[0].reversed : false;

      var serType = ($.trim(graphObj.options.chart.defaultSeriesType)) ? graphObj.options.chart.defaultSeriesType : false;
      var stackFlag = $.trim(graphObj.options.plotOptions.column.stacking);

      if (stackFlag == 'true') {
        //alert('stackFlag - >' + stackFlag)
        serType = 'stacked';
      }

      if (graphObj.options.plotOptions.column.scatterLine == true) {
        serType = 'scatterLine';
      }

      var fileType = 'application/pdf';

      if (type == 'jpeg')
        fileType = 'image/jpeg';
      else if (type == 'png')
        fileType = 'image/png';
      else if (type == 'svg')
        fileType = 'image/svg+xml';

      //var fName = $('#countryName').text()+'_'+chartDiv.find('h2.chart_Title').text();
      //var title = chartDiv.find('h2.chart_Title').text();
      var title = chartTitle;
      var fName = '';
      var subtitle_text = $('.top h3').text();
      titleprop = {text: title, style: {fontSize: '11px', color: '#3E576F'}, useHTML: true};
      graphObj.exportChart({
        type: fileType
        , filename: fName //areaName - chart title(alphabets only).pdf
      },
              {title: titleprop, subtitle: {text: subtitle_text}, legend: {title: '', y: 20}}
      );

      return false;
    });

    showChart = function (obj, objSettings) {
      this.containerWidth = '';
      //Set variables to use later for undo of full screen

      //Getting visualization container width
      this.containerWidth = obj.chartWidth;
      //Getting visualization container height
      this.containerHeight = obj.chartHeight;
      //Getting chart title properties
      this.titleProperties = dfa_fullscreen.getChartTitleProperties('title', obj);
      //Getting chart subtitle properties
      this.subTitleProperties = dfa_fullscreen.getChartTitleProperties('subtitle', obj);

      //Getting chart original legend settings used to restore legend
      this.legendOldSettings = obj.legend;

      //Getting chart x-axis and y-axis properties
      var xAxisChartProperties = dfa_fullscreen.getChartAxisproperties(obj, 'xAxis', objSettings.xAxis);
      var yAxisChartProperties = dfa_fullscreen.getChartAxisproperties(obj, 'yAxis', objSettings.yAxis);

      //Getting chart data labels properties
      var dataLabelsProperties = dfa_fullscreen.getChartDataLblProperties(obj);

      //Getting chart parent container width and height to use later for undo of full screen
      var containerParentDivWidth = dfa_fullscreen.fullScreenContDivIDObj.width();
      var containerParentDivHeight = dfa_fullscreen.fullScreenContDivIDObj.height();

      /*
       * $ Blocking function to masking/unmasking screen when on/off fullscreen
       */
      $.blockUI({
        //Container Parent div object
        message: dfa_fullscreen.fullScreenContDivIDObj,
        //Deafult css to be used for masking
        css: {
          top: '0%', left: '', right: '0px', width: '100%', height: '100%', cursor: 'auto'
        },
        //When page is blocked to show full screen
        onBlock: function () {
          var chartId = $(this).children().children().attr('id').replace('graph', '');
          var graphObj = window[chartId];

          //Call function to add export options
          dfa_fullscreen.addExportOptions();

          //Call function to save new chart settings
          dfa_fullscreen.saveChartNewSettings();

          //Set chart size as per as full screen
          if (!dfa_fullscreen.viewTblDfltFlg)				//if by default table view is not on
            dfa_fullscreen.obj.setSize(dfa_fullscreen.fullScreenContDivIDObj.width(), dfa_fullscreen.fullScreenContDivIDObj.height(), true);
          //Call function to add share options
          if (dfa_fullscreen.objShareOptions.enabled)
            dfa_fullscreen.addShareOptions();

          //Call function to view chart data in table format
          if (dfa_fullscreen.viewTblDfltFlg)				//if by default table view is on
            dfa_fullscreen.viewTable();

          $('#TblDtVw').css({'margin-top': '0px'});
          $('#visTblDvId').css({'margin-top': '0px'});
          if (chartId == 'CO2')
          {
            $('#CO2').css({'margin': '3px'});
            graphObj.setTitle({
              y: 0
            });
          }
          return false;

        },
        // when page is unblocked to hide full screen
        onUnblock: function () {
          $('.icon_bg').css('display', 'block');
          var chart = dfa_fullscreen.containerParentDivIDObj.selector.replace('#graph', '');
          var graphObj = window[chart];
          graphObj.setTitle({
            text: ''
          });

          if (chart == 'CO2')
          {
            chartID = 'CO2';
            $('#CO2').css({'margin-top': '90px'});
            $('#graph' + chartID).find('span:eq(0)').css("left", "365px");
            $('#graph' + chartID).find('span:eq(1)').css("left", "365px");
            $('#graph' + chartID).find('span:eq(2)').css("left", "365px");
            $('#graph' + chartID).find('span:eq(0)').css("top", "15px");
            $('#graph' + chartID).find('span:eq(1)').css("top", "107px");
            $('#graph' + chartID).find('span:eq(2)').css("top", "233px");

          }

          if (typeof dfa_fullscreen.obj.userOptions != 'undefined') {
            // call function to remove map title and sub title
            dfa_fullscreen.removeMapTtlSubTtl();

            //Call function to restore chart previous settings
            dfa_fullscreen.restoreChartPreviousSettings(xAxisChartProperties, yAxisChartProperties, dataLabelsProperties);

            //Set container parent div old width and height
            dfa_fullscreen.fullScreenContDivIDObj.width(containerParentDivWidth).height(containerParentDivHeight);

            //Set visualization old size
            dfa_fullscreen.obj.setSize(dfa_fullscreen.containerWidth, dfa_fullscreen.containerHeight, true);
          } else {
            $(window).resize();
          }

          //unwrap newly added full screen container div
          dfa_fullscreen.fullScreenContDivIDObj.unwrap();
          dfa_fullscreen.containerParentDivIDObj.unwrap();
          $('.highcharts-subtitle').css({'display': 'none'});
          $('#visTblDvId').css({'display': 'none'});
          return false;
        }
      });
    }

    //Full Screen
    $('a.icon_four').on('click', function () {
      var containerParentDivID = visDivID = obj = window_height = null;
      var window_height = $(window).height();

      // Hide scroll bar in full screen
      $('html').css('overflow', 'hidden');

      var containerParentDivID = $(this).parent("div").parent("div").parent("div").attr('id');
      // get chart container div id
      var visDivID = $(this).parent("div").parent("div").next('div[id^="graph_"]').attr('id');
      if (visDivID == undefined)
        var visDivID = $(this).parent("div").parent("div").next('div[id^="map_"]').attr('id');

      //console.log(containerParentDivID+'  '+visDivID);
      var chartTitle = '';
      //alert(containerParentDivID);
      switch (containerParentDivID)
      {
        case 'p-VO_1':
          chartTitle = "Population Distribution, by Residence and Region";
          break;
        case 'p-VO_2':
          chartTitle = "Parental Residence in Household among Adolescents aged 10-14";
          break;
        case 'p-VO_3':
          chartTitle = "Marital Status among Adolescent Girls aged 15-24";
          break;
        case 'p-VO_4':
          chartTitle = "Marital Status among Adolescent Girls aged 15-24";
          break;
        case 'p-VO_5':
          chartTitle = "School Attendance among Adolescents aged 10-19";
          break;
        case 'p-VO_6':
          chartTitle = "Marital Status among Adolescent Girls aged 15-24";
          break;
        case 'p-VO_7':
          chartTitle = "School Attendance among Adolescents aged 10-19";
          break;
        case 'p-VO_8':
          chartTitle = "Percentage of women aged 20-24 who got married before age 18/15";
          break;
        case 'p-VO_9':
          chartTitle = "Percentage of women aged 20-24 who gave birth before age 18/15";
          break;
        case 'p-VO_10':
          chartTitle = " Percentage of currently married/in union females who currently using/not currently using contraception";
          break;
        case 'p-VO_11':
          chartTitle = "Percentage of currently married/in union females aged 15-24 who have an unmet need for family planning";
          break;
        case 'p-VO_12':
          chartTitle = "Percentage of currently married/in union females aged 15-24 who have their contraception demand satisfied";
          break;
        case 'p-VO_13':
          chartTitle = "Sexual activity among never-married 15-19 year old girls (percent)";
          break;
        case 'p-VO_14':
          chartTitle = "Age difference between women and current husband/cohabiting partner, among female aged 15-24 (percent)";
          break;
        case 'p-VO_15':
          chartTitle = " Percentage of 15-24 year old females who think that wife beating is justified under at least one condition";
          break;
        case 'p-VO_16':
          chartTitle = "Percentage of currently married women age 15-24 who usually make decisions regarding contraceptive use either by themselves or jointly with their husbands";
          break;
        case 'p-VO_17':
          chartTitle = "Percentage of females aged 15-24 who have comprehensive Knowledge of HIV/AIDS";
          break;
      }


      $('#' + containerParentDivID).find($('div.dfapi_chartTbl')).hide();
      var subgp = $('#' + visDivID).parent().parent().find('.dd-selected-text').html();
      if ($.trim(subgp) != '')
      {
        var chartTitle = chartTitle + ' ,' + subgp;

      }

      // visualization object type
      var objType = 'chart';

      var obj = window[visDivID];

      // visualization object type
      var objType = 'chart';

      var obj = window[visDivID];
      //var subtitle_text =  ' ';
      var subtitle_text = $('.top h3').text();

      if (visDivID == 'mapDivId') {
        objType = 'map';
        // chartTitle = Ind_Name;
        //chartTitle = $('#Ind_Name').html();
      } else {
        objType == 'chart';
        //console.log(chartTitle);
      }

      // get chart object
      if (objType == 'chart') {
        // visualization object new/additional settings for full screeen
        var objSettings = {
          'title': {
            'text': chartTitle,
            'align': 'center',
            'style': {
              'color': '#666666',
              'fontWeight': 'bold',
              'font-size': '12px',
              'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
            }
          },
          'subtitle': {
            'enabled': true,
            'text': subtitle_text,
            'align': 'center',
            'style': {
              'color': '#666666',
              'fontWeight': 'bold',
              'font-size': '9px',
              'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
            }

          }
        };
      }

      // visualization object share options
      var objShareOptions = {
        'enabled': false,
        'url': (window.location != window.parent.location) ? document.referrer : document.location.href,
        'iconSize': 'big',
        'callback': '',
        'onmousehover': false,
        'containerParentDivID': containerParentDivID,
        'containerDivId': visDivID,
        'chartType': objType
      };

      // set flag to show table by default
      var tblDefaultOpt = true;
      if (visDivID == 'map') {

        tblDefaultOpt = false;
      }

      resetSelVisStatus(containerParentDivID, visDivID);

      //call function to show full screen
      dfa_fullscreen.show(objType, obj, containerParentDivID, objSettings, objShareOptions, tblDefaultOpt);
      $('.icon_bg').css('display', 'none');

      return false;


      /*var chartID = $(this).parent("div").parent("div").next('div[id^="graph_"]').attr('id');
       var graphObj = window[chartID];
       var chartDiv = $(this).parent("div").parent("div").parent("div");

       var cheight = graphObj.chartHeight;
       var cwidth = graphObj.chartWidth;

       IconImgFlag = true;					//set screen flag to true
       //alert( ($(window).width()-100)+' - '+ ( $(window).height()-100) );

       graphObj.setSize($(window).width()-100,$(window).height()-100,false);

       $.blockUI({
       message: chartDiv,
       css: {
       top: '0%', left: '', right: '0px',width:'100%',height:'100%',cursor:'auto'
       },
       onBlock: function() {
       chartDiv.find('div.icon_bg').hide();
       chartDiv.find('div.dropdown').hide();
       $('#table_ppl_dstrbtn_resd_regn_tabledata').hide();
       chartDiv.find('h2').hide();
       chartDiv.css( "width", "100%" )
       chartDiv.find('div.BoxClose').show();
       $('#table'+chartID).remove();
       return false
       },
       onUnblock: function() {
       chartDiv.find('div.dropdown').show();
       chartDiv.find('h2').show();
       chartDiv.css( "width", cwidth-20 )
       chartDiv.find('div.BoxClose').hide();
       chartDiv.find('div.icon_bg').show();
       $('#table_ppl_dstrbtn_resd_regn_tabledata').show();

       graphObj.setSize(cwidth,cheight,false);
       return false
       }
       });

       return false;*/
    });
//redrawing alll the charts when window is resized
    $(window).resize(function () {

      makeMapGraphTable();	//call function to pass data into map, chart and table

      $(document).on('change', "#slctindi_id4", function (el) {
        makeBarChart('graph_mrtl_status_adolescnt1', $(el.target).val());
      });
    });
    function resetSelVisStatus(containerParentDivID, visDivID) {

      // var containerParentDivID = $('#' + containerParentDivID).parent().attr('id');
      //console.log(containerParentDivID);

      // if selected visualization is already being shown
      if ($('#' + containerParentDivID).find('div.dfapi-visTbl-container').length) {
        visTblContDivID = $('#' + containerParentDivID).find('div.dfapi-visTbl-container').attr('id');

        $('#' + containerParentDivID).find($('#' + visDivID)).show();
        $('#' + containerParentDivID).find($('#' + visTblContDivID)).remove();

      }
    }

    // - Load highcharts map data
    loadHCMapData = function (mapGeojson, mapData, div_var) {

      var subtitleFlag = true;
      var dataFlag = false;
      var realData = '';
      var minData = 0;
      var maxData = 100;
      var realCode = '';
      var realTmp = '';
      var legendName = '';
      var realData = new Array();
      var widthVal = $('#mapDivId').width();
      if (typeof widthVal != 'undefined' && widthVal != 0)
        mapWidth = widthVal;
      if (mapData && RangeOnePointVal.length > 1)
      {
        if ([selOpt] in IndLowerIsGood)    // check if the selected indicator is in the array IndLowerIsGood
        {
          brk_colors = ['#FF552D', '#FFCC00', '#6699FF', '#0000FF']; // Legend Color Code when low is good
          var dataClassesArr = [{from: Number(RangeOnePointVal[0].toFixed(1)), to: Number(RangeOnePointVal[1].toFixed(1)), name: legend_labels[0], color: "#FF552D"}, {from: Number((RangeOnePointVal[1] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[2].toFixed(1)), name: legend_labels[1], color: "#FFCC00"}, {from: Number((RangeOnePointVal[2] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[3].toFixed(1)), name: legend_labels[2], color: "#6699FF"}, {from: Number((RangeOnePointVal[3] + 0.1).toFixed(1)), to: Number((RangeOnePointVal[3] + 0.1).toFixed(1)) + 50, name: legend_labels[3], color: "#0000FF"}];
        } else
        {
          brk_colors = ['#0000FF', '#6699FF', '#FFCC00', '#FF552D']; //variable for legend color array
          var dataClassesArr = [{from: Number(RangeOnePointVal[0].toFixed(1)), to: Number(RangeOnePointVal[1].toFixed(1)), name: legend_labels[0], color: "#0000FF"}, {from: Number((RangeOnePointVal[1] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[2].toFixed(1)), name: legend_labels[1], color: "#6699FF"}, {from: Number((RangeOnePointVal[2] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[3].toFixed(1)), name: legend_labels[2], color: "#FFCC00"}, {from: Number((RangeOnePointVal[3] + 0.1).toFixed(1)), to: Number((RangeOnePointVal[3] + 0.1).toFixed(1)) + 50, name: legend_labels[3], color: "#FF552D"}];
        }
      } else
      {
        var brk_colors = [];
        var customArr = [];
      }
      // Get join by array based selected area id key in map geojson shape file
      var joinByArr = ['ID_', 'code'];
      /*if(typeof mapGeojson.features[0].properties.ID_ !=='undefined'){
       joinByArr = ['ID_', 'code'];
       }*/
      // Initiate the chart

      window[div_var] = new Highcharts.Map({
        chart: {
          renderTo: div_var,
          borderWidth: 0,
          backgroundColor: '#fff',
          style: {
            fontFamily: '"Helvetica Neue",Helvetica,Arial,sans-serif'
          },
        },
        title: {
          text: ' ',
          style: {
            color: '#000',
            font: 'bold 14px "Helvetica Neue",Helvetica,Arial,sans-serif'
          }
        },
        subtitle: {
          useHTML: true,
          text: ' ',
          style: {
            color: '#70A7FF',
            font: 'bold 11px "Helvetica Neue",Helvetica,Arial,sans-serif'
          }
        },
        mapNavigation: {
          enabled: false,
          enableMouseWheelZoom: false,
          enableDoubleClickZoom: false,
          enableDoubleClickZoomTo: false
        },
        colorAxis: {dataClasses: dataClassesArr},
        legend: {
          layout: 'horizontal',
          align: 'center',
          verticalAlign: 'bottom',
          floating: false,
          title: {
            text: ' '
          },
          itemStyle: {
            fontWeight: '0',
            fontStyle: '"Helvetica Neue",Helvetica,Arial,sans-serif',
            color: '#7B7B7B',
            textDecoration: 'none'
          }
        },
        plotOptions: {
          series: {
            cursor: 'pointer',
            point: {
              events: {}
            }
          }
        },
        tooltip: {
          useHTML: true,
          formatter: function () {
            return this.point.properties.NAME1_ + ': ' + this.point.value;
          }
        },
        exporting: {enabled: false},
        credits: {enabled: false},
        series: [{
            data: mapData,
            mapData: mapGeojson,
            name: legendName,
            allAreas: true,
            states: {
              hover: {
                color: '#BADA55',
              }
            },
            joinBy: joinByArr,
            dataLabels: {
              enabled: true,
              formatter: function () {

                //console.log(this);
              },
            }
          }]

      }, function (obj) {

        setTimeout(function () {
        }, 100);
      });
    };
// function used in cases when file does not exist and onchange of indicators data is required
    function getApidata(selOpt) {
      mpdataCntselectedApi = 0;
      //console.log('getApidata called ');
      //console.log(mapDatafrmApi);
      //console.log(mpdataCntselectedApi);
      var allIusDataApi = [];
      var iusSelected = AREA_JSON_DATA_OBJ['by_' + MAP_DIV][selOpt]['IUSGID'];
      if (iusSelected != '') {
        iusGidSelSplit = iusSelected.split("||");
        concatIusGid = iusGidSelSplit[0] + "," + iusGidSelSplit[1] + "," + iusGidSelSplit[2];
      }
      //console.log(concatIusGid);

      for (var mdInd in mapDatafrmApi) {

        var mpdataSecIndApi = mapDatafrmApi[mdInd];
        mdIndSplitApi = mdInd.split(',');
        mdIndConcatApi = mdIndSplitApi[0] + '||' + mdIndSplitApi[1] + '||' + mdIndSplitApi[2];
        allIusDataApi[mdInd] = [];

        for (var mdInnerInd in mpdataSecIndApi) {

          for (var mdSecondInnerInd in mpdataSecIndApi[mdInnerInd]) {

            if (mdInd == concatIusGid) {
              allIusDataApi[mdInd][mpdataCntselectedApi] = [];
              allIusDataApi[mdInd][mpdataCntselectedApi]['code'] = mdSecondInnerInd;
              allIusDataApi[mdInd][mpdataCntselectedApi]['id'] = mdSecondInnerInd;
              allIusDataApi[mdInd][mpdataCntselectedApi]['value'] = mpdataSecIndApi[mdInnerInd][mdSecondInnerInd][0];
              //allIusData[mdInd]= mpdataSecIndApi;
              mpdataCntselectedApi++;
            }
          }

        }
      }
      //console.log('mapDatafrmApi');
      //console.log('selOpt');
      //console.log(selOpt);

      var mapData1 = allIusDataApi[concatIusGid];
      var mpJsonObj1 = convArrToObj(mapData1);
      var mpJsonObjtoArr1 = convObjToArr(mpJsonObj1);
      var mapData = mpJsonObjtoArr1;
      return mpJsonObjtoArr1;
    }

//function to get selected indicator map data
    function getMapData()
    {
      if (chckMapDataFlg)			//if map indicator data found
      {
        mapIndctData = $('#slctindi_id').data('ddslick');
        selOpt = mapIndctData.selectedData.value;
        //console.log('selOpt set in get map data');

        //get selected map indicator option
        return mapDisplayData[selOpt]['seriesData'];
      } else {									//if no map indicator data found
        return '';
      }
    }

    if (chckMapDataFlg) {									//if map indicator data found
      //Map Dynamic Legend
      //var mapIndctData = $('#slctindi_id').data('ddslick');
      selOpt = "perc_girl_age_20_24_mrd_bfr_15";
      //selOpt = mapIndctData.selectedData.value;
    } else {												//if map indicator data not found

      var mapIndctData = [];
      selOpt = '';
      var RangeValArr = new Array();
      var legend_labels = new Array();
      var RangeOnePointVal = new Array();
    }
//-----rendermaphighchartapi function with body
    var renderMapHighchartsAPI = function (selOpt, div_var) {

      //mapDisplayData
      var mpdataCnt = 0;
      var allIusGids = [];
      /*console.log('called from api');
       console.log(AREA_JSON_DATA_OBJ['by_'+MAP_DIV]);
       console.log(selOpt);
       console.log(AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]);*/

      var filexistAreaIdStatus = '';
      if (filexistAreaIdStatus == true) { //case when file found
        var iusSelected = mapDisplayData[selOpt]['IUSGID'];
        //var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&data=false&tp=mrd';
        var callbackURL = MAPS_API_URL + allareaLevel5 + '&getChildren=no&data=false&tp=mrd';
        if (SEL_AREA_ID == 'NPL' || SEL_AREA_ID == 'SLE') {
          //  callbackURL += '&areaLevel=6';
          //var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&'+'data=false&tp=mrd&areaLevel=6';

        }
      } else {
        //case when file not  found

        var iusSelected = AREA_JSON_DATA_OBJ['by_' + MAP_DIV][selOpt]['IUSGID'];
        var allData = AREA_JSON_DATA_OBJ['by_' + MAP_DIV]; //get all ius gids from existing xml of area of node  map
        for (var ind in allData) {
          allIusGids[ind] = allData[ind]['IUSGID'];
        }
        var concatAllIusGid = '';
        var iusGidSelSplitall = '';
        for (i in allIusGids) {
          iusGidSelSplitall = allIusGids[i].split("||");
          concatAllIusGid += iusGidSelSplitall[0] + "," + iusGidSelSplitall[1] + "," + iusGidSelSplitall[2];
          concatAllIusGid += '{~}';
        }

        // var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&ius=' + concatAllIusGid + '&data=true&tp=mrd';

        var callbackURL = MAPS_API_URL + allareaLevel5 + '&getChildren=no&ius=' + concatAllIusGid + '&data=true&tp=mrd';
        //console.log('concatAllIusGid');
        //console.log(concatAllIusGid);
        if (SEL_AREA_ID == 'NPL' || SEL_AREA_ID == 'SLE') {
          //  callbackURL += '&areaLevel=6';
          //var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&ius=' + concatAllIusGid + '&data=true&tp=mrd&areaLevel=6';

        }
      }
      console.log(callbackURL);

      // SERVER_NAME = "localhost";
      var calltype = "json";
      var concatIusGid = '';
      var n = MAPS_API_URL.indexOf(SERVER_NAME);
      if (n == -1)
        calltype = "jsonp";
      //console.log(AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]['IUSGID']);
      //var iusSelected = AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]['IUSGID'];
      //var iusSelected = mapDisplayData[selOpt]['IUSGID'];
      if (iusSelected != '') {
        iusGidSelSplit = iusSelected.split("||");
        concatIusGid = iusGidSelSplit[0] + "," + iusGidSelSplit[1] + "," + iusGidSelSplit[2];
      }
      //console.log('selectedius ==='+concatIusGid);
      //var iusSelected = 'PRP_WMN_20-24_YR_MRD_18,PER,F_20-24_YR';


      // console.log(AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]);

      //console.log(callbackURL);
      var mpdataCntselected = 0
      $.ajax({
        type: "GET",
        url: callbackURL,
        async: false,
        data: {},
        dataType: calltype,
        beforeSend: function () {
          //showLoader();
        },
        success: function (data) {

          if ($.trim(data.map) != '') {
            //console.log('after api called ');
            mapGeojson = data.map; // map always from api
            //console.log("data");
            console.log(mapGeojson);
            // case below execute when file not found
            if (filexistAreaIdStatus == false) {
              mapDatafrmApi = data.data;
              var finalMapData = [];
              var allIusData = [];
              // prepare format of object for display data from api

              //var lengthOfApiObj =  Object.size(mapDatafrmApi);
              //console.log(lengthOfApiObj+'--lenght');
              //var maincnt=0;
              dataformatStatus = true;
              for (var mdInd in mapDatafrmApi) {
                dataformatStatus = false;
                var selectediusFlag = false;
                if (mdInd == concatIusGid) {
                  selectediusFlag = true;
                  //console.log(mdInd+'==mdInd is the selected indicator ');
                }
                var mpdataSecInd = mapDatafrmApi[mdInd];
                var mpdataInnerCnt = 0;
                mdIndSplit = mdInd.split(',');
                mdIndConcat = mdIndSplit[0] + '||' + mdIndSplit[1] + '||' + mdIndSplit[2];
                allIusData[mdInd] = [];
                finalMapData[mdIndConcat] = [];
                for (var mdInnerInd in mpdataSecInd) {

                  for (var mdSecondInnerInd in mpdataSecInd[mdInnerInd]) {

                    finalMapData[mdIndConcat][mpdataCnt] = [];
                    finalMapData[mdIndConcat][mpdataCnt]['code'] = mdSecondInnerInd;
                    finalMapData[mdIndConcat][mpdataCnt]['id'] = mdSecondInnerInd;
                    finalMapData[mdIndConcat][mpdataCnt]['value'] = mpdataSecInd[mdInnerInd][mdSecondInnerInd][0];
                    if (selectediusFlag == true) {
                      allIusData[mdInd][mpdataCntselected] = [];
                      allIusData[mdInd][mpdataCntselected]['code'] = mdSecondInnerInd;
                      allIusData[mdInd][mpdataCntselected]['id'] = mdSecondInnerInd;
                      allIusData[mdInd][mpdataCntselected]['value'] = mpdataSecInd[mdInnerInd][mdSecondInnerInd][0];
                      mpdataCntselected++;
                      //console.log(mpdataCntselected+'==mpdataCntselected');
                      //console.log(selectediusFlag+'==selectediusFlag');

                    }
                    mpdataCnt++;
                  }

                }
                //maincnt++;
                //if(maincnt==lengthOfApiObj){
                //enable format status use this in file creation when whole format process completed
                //	dataformatStatus=true;
                //}
              }

              var finalMapDataObj = convArrToObj(finalMapData);
              if (finalMapDataObj != '') {
                dataformatStatus = true; //preparing format process is completed to post
              }


              //console.log('selected name=='+selOpt);
              //console.log('finalMapData');
              //	console.log(finalMapData);
              //console.log(allIusData);
              var mapDataAp = allIusData[concatIusGid];
              var mpJsonObj = convArrToObj(mapDataAp);
              var mpJsonObjtoArr = convObjToArr(mpJsonObj); //format process completed to display selected ius  data
              //console.log('mapData inisde apimpJsonObjtoArr');
              console.log(finalMapDataObj);
              var allIusGidsObj = convArrToObj(allIusGids);
              mapData = mpJsonObjtoArr;
              //mapData=mpJsonObjtoArr;
              //create file when format process completed
              //console.log("check");
              //console.log(WEBSITE_BASE_URL);

              if (dataformatStatus == true) {
                ChangeLegend(selOpt);

                loadHCMapData(mapGeojson, mpJsonObjtoArr, div_var);//display selected ius data using api
//                $.ajax({
//                  type: "POST",
//                  url: WEBSITE_BASE_URL + "pages/createMapDataFile", //call to create file
//                  async: false,
//                  //data: {'mapdataVal': finalMapDataObj, 'allIusGids': allIusGidsObj, 'areaId': SEL_AREA_ID, 'innerMap': true}, // for inner map only
//                  data: {'api_url': callbackURL, 'allIusGids': allIusGidsObj, 'areaId': SEL_AREA_ID, 'innerMap': true}, // for inner map only
//                  dataType: "json",
//                  beforeSend: function () {
//                    //showLoader();
//                  },
//                  success: function (sucData) {
//                    //console.log('File created succesfully');
//                    //loadHCMapData(mapGeojson,sucData);
//                  },
//                  cache: true
//                });
              }




            } else {
              //console.log('no api called for this case');
              var mapData = getMapData();
              //console.log(mapData);
              loadHCMapData(mapGeojson, mapData, div_var); //display selected ius data using api

            }

          } else {
            console.log('Map is empty');
          }

        },
        error: function (result) {
          console.log("ERROR");
        },
        cache: true
      });
    }

//Child marriage map
    selOpt = "perc_girl_age_20_24_mrd_bfr_15";
    div_var = "map_area_indicator_data";
    renderMapHighchartsAPI(selOpt, div_var);


    // Adolescent pregnancy map
    selOpt = "perc_girl_age_20_24_gave_birth_bfr_15";
    div_var = "map_area_indicator_data_adolescent_prg";
    renderMapHighchartsAPI(selOpt, div_var);


    //redrawing alll the charts when window is resized
    $(window).resize(function () {

      makeMapGraphTable();	//call function to pass data into map, chart and table

      $(document).on('change', "#slctindi_id4", function (el) {
        makeBarChart('graph_mrtl_status_adolescnt1', $(el.target).val());
      });
    });

    /*
     Function to render highcharts map, map comes form database usin API
     */
    Object.size = function (obj) {
      var size = 0, key;
      for (key in obj) {
        if (obj.hasOwnProperty(key))
          size++;
      }
      return size;
    };
    var convArrToObj = function (array) {
      var thisEleObj = new Object();
      if (typeof array == "object") {
        for (var i in array) {
          var thisEle = convArrToObj(array[i]);
          thisEleObj[i] = thisEle;
        }
      } else {
        thisEleObj = array;
      }

      return thisEleObj;
    };

    var convObjToArr = function (Obj) {
      var returArr = [];
      for (var i in Obj) {
        returArr[i] = Obj[i];
      }
      return returArr;
    };


    //Function to change map legend dyanmically
    function ChangeLegend(selOpt) {

      //	console.log(selOpt+'=====selOpt called ChangeLegend ');
      if (selOpt != '')
      {
        filexistAreaIdStatus = "";
        if (filexistAreaIdStatus == true)
          var dataArr = mapDisplayData[selOpt]['seriesData'];
        else
          var dataArr = getApidata(selOpt);
        //console.log(dataArr);
        //console.log('dataArr in ChangeLegend ');
        //var	dataArr = AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]['seriesData'];
        //var	dataArr = mapDisplayData[selOpt]['seriesData'];
        // creating new array for min and max
        valArr = new Array();
        $.each(dataArr, function (ID, DV) {
          //console.log(DV['value']);
          valArr.push(DV['value']);
        });
        // find min and max value
        var maxVal = Math.max.apply(Math, valArr); // 3
        var minVal = Math.min.apply(Math, valArr); // 1
        var rangeDiffVal = maxVal - minVal;
        //console.log('maxVal == '+maxVal + "   minVal === "+ minVal + "  rangeDiffVal ===" + rangeDiffVal );
        var rangeVal = (rangeDiffVal / 4);
        //console.log('  rangeVal'+rangeVal+ ' RangeValArr-->'+RangeValArr);

        //Craeting New array with values from min to max with rageVal interval
        RangeValArr = new Array();
        for (var i = minVal; i < maxVal; i = (i + rangeVal))
        {
          RangeValArr.push(i);
        }
        //console.log('  rangeVal   '+rangeVal+ ' RangeValArr-->   '+RangeValArr);
        if (RangeValArr.length > 1)	//if range value is greater than 1 then give range and legend label
        {
          RangeOnePointVal = [RangeValArr[0], RangeValArr[1], RangeValArr[2], RangeValArr[3]];
          legend_labels = [RangeValArr[0].toFixed(1) + " - " + RangeValArr[1].toFixed(1), (RangeValArr[1] + 0.1).toFixed(1) + " - " + RangeValArr[2].toFixed(1), (RangeValArr[2] + 0.1).toFixed(1) + " - " + RangeValArr[3].toFixed(1), (RangeValArr[3] + 0.1).toFixed(1) + " and More"];
        }
        //console.log("min-->"+minVal+"  max-->"+maxVal+"  Range-->"+rangeVal);
        //console.log(RangeOnePointVal);
        //console.log(legend_labels);
      }
    }


// function used in cases when file does not exist and onchange of indicators data is required
    function getApidata(selOpt) {
      mpdataCntselectedApi = 0;
      //console.log('getApidata called ');
      //console.log(mapDatafrmApi);
      //console.log(mpdataCntselectedApi);
      var allIusDataApi = [];
      var iusSelected = AREA_JSON_DATA_OBJ['by_' + MAP_DIV][selOpt]['IUSGID'];

      if (iusSelected != '') {
        iusGidSelSplit = iusSelected.split("||");
        concatIusGid = iusGidSelSplit[0] + "," + iusGidSelSplit[1] + "," + iusGidSelSplit[2];
      }
      //console.log(concatIusGid);

      for (var mdInd in mapDatafrmApi) {

        var mpdataSecIndApi = mapDatafrmApi[mdInd];
        mdIndSplitApi = mdInd.split(',');
        mdIndConcatApi = mdIndSplitApi[0] + '||' + mdIndSplitApi[1] + '||' + mdIndSplitApi[2];
        allIusDataApi[mdInd] = [];
        //

        for (var mdInnerInd in mpdataSecIndApi) {

          for (var mdSecondInnerInd in mpdataSecIndApi[mdInnerInd]) {

            if (mdInd == concatIusGid) {
              allIusDataApi[mdInd][mpdataCntselectedApi] = [];
              allIusDataApi[mdInd][mpdataCntselectedApi]['code'] = mdSecondInnerInd;
              allIusDataApi[mdInd][mpdataCntselectedApi]['id'] = mdSecondInnerInd;
              allIusDataApi[mdInd][mpdataCntselectedApi]['value'] = mpdataSecIndApi[mdInnerInd][mdSecondInnerInd][0];
              //allIusData[mdInd]= mpdataSecIndApi;
              mpdataCntselectedApi++;

            }
          }

        }
      }
      //console.log('mapDatafrmApi');
      //console.log('selOpt');
      //console.log(selOpt);

      var mapData1 = allIusDataApi[concatIusGid];
      var mpJsonObj1 = convArrToObj(mapData1);
      var mpJsonObjtoArr1 = convObjToArr(mpJsonObj1);
      var mapData = mpJsonObjtoArr1;
      return mpJsonObjtoArr1;

    }


//// when 'Sex and Age Group' (pie chart) select box changes
//    $('#sel_ppl_dstrbtn_resd_regn').ddslick({
//      width: 170,
//      onSelected: function (sData) {
//        //call function to make pie Chart
//        makePieChart('graph_ppl_dstrbtn_resd_regn', sData.selectedData.value);
//      }
//    });

    //function to make pieChart
    function makePieChart(graphDiv, selOpt)
    {

      pieChartData = getChartXMLDataNode(graphDiv, selOpt, GRAPH_TYPE);

      //if pie chart data found properly
      if (pieChartData !== undefined && pieChartData != '' && pieChartData != null)
      {
        var pieDataSet = pieChartData.seriesData;

        //console.log(pieChartData)

        //set pie size attributes
        pieDataSet[0].size = '25%';
        pieDataSet[1].innerSize = '50%';
        pieDataSet[1].size = '80%';
        pieDataSet[0].showInLegend = true;	//showed urban and rural in legend

        //set first data point label to white
        pieDataSet[0].data[0].dataLabels = {"color": "#fff", style: {fontSize: '10px'}};
        pieDataSet[0].data[1].dataLabels = {"color": "#fff", style: {fontSize: '10px'}};
        pieDataSet[0].dataLabels = {"distance": -20, "connectorWidth": 0, "color": "#fff", style: {fontSize: '10px'}};
        //pieDataSet[1].data[0].dataLabels = {"color" :  "#fff"};
        var dis = '';
        var col = '';
        function setDisCol(d, c) {
          dis = d;
          col = c;
        }


        var width = $(window).width();
        if (width > 930)
          width = 450;
        else if (width > 640 && width < 900)
          width = width / 2 - 20;
        else
          width = width - 10;

        chartSettings = {
          renderTo: graphDiv,
          type: 'pie',
          height: 320,
          width: width,
        };

        // Create the chart
        window[graphDiv] = new Highcharts.Chart({
          chart: chartSettings,
          exporting:
                  {
                    enabled: false
                  },
          legend: {
            enabled: true,
            layout: 'vertical', //vertical
            backgroundColor: '#FFFFFF',
            align: 'right',
            verticalAlign: 'middle', //middle
            floating: false,
            borderWidth: 0,
            //x: 10,
            //y: 0,
            borderWidth: 0,
                    borderRadius: 0,
            itemMarginTop: 2,
            itemMarginBottom: 2,
            symbolPadding: LEGENDITEM_SYMBOL_PADDING,
            symbolWidth: LEGENDITEM_SYMBOL_WIDTH,
            itemStyle: {
              fontSize: LEGENDITEM_FONTSIZE
            }

          },
          credits: {
            enabled: false
          },
          title: {
            text: ''
          },
          yAxis: {
            title: {
              text: ''
            }
          },
          plotOptions: {
            pie: {
              allowPointSelect: true,
              cursor: 'pointer',
              dataLabels: {
                enabled: false,
                /*distance: dis,
                 color: col,*/
                formatter: function () {
                  return this.y + '%';
                }
              },
              //showInLegend: true,
              center: ['50%', '50%']	//[left,top]
            }},
          tooltip: {
            formatter: function () {
              return this.key + ' : ' + this.y + '%';
            }},
          series: pieDataSet
        });
      } else {
        window[graphDiv] = " ";
        $("#" + graphDiv).html("Data not available").css({"text-align": "center", "margin": "50px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
      }
    }

    getFirstOtion = function (jsonObj)
    {
      for (var propName in jsonObj) {
        if (jsonObj.hasOwnProperty(propName)) {
          //console.log(propName);
          return propName;    // or do something with it and break
        }
      }
    }
//function to pass data into graph from xml graph node
    function makeGraph(graphDiv, graphOption)
    {

      var firstOpt = '';
      if (typeof (graphOption) == 'object')
      {
        //alert('object->  '+graphDiv+ '  lennn-->'+ graphOption.length+ '  typ-->'+ typeof (graphOption) + '  src-->'+graphOption.toSource());
        firstOpt = getFirstOtion(graphOption);
      } else if (typeof (graphOption) == 'string')
      {
        //alert('string->  '+ graphDiv+ '  lennn-->'+ graphOption.length+ '  typ-->'+ typeof (graphOption) + '  src-->'+graphOption.toSource());

      }
      //alert('firstOpt   '+firstOpt);

      if (graphDiv == PIE_CHART_DIV_1)
      {
        makePieChart(graphDiv, firstOpt);		//call function to make pie chart
      } else {

        //if(graphDiv !='graph_perc_female_sexuly_active' && graphDiv != 'graph_perc_mrd_female_used_or_not_contrcptn')
        //{

        makeBarChart(graphDiv, firstOpt);		//call function to make bar chart
        if (graphDiv == 'graph_mrtl_status_adolescnt') {
          makeBarChart('graph_mrtl_status_adolescnt1', 'girl_15_19');
          //console.log(firstOpt);
        }

        //}
      }
    }
    makeMapGraphTable();

    // intergrated function make map, graph and table
    function makeMapGraphTable()
    {

      $.each(chartMapConfigXMLNodeObj, function (key, val) {

        if (key.search("map_") != '-1')							//if map request called
        {
          //makeMap(key);									// call function to plot map data

        } else if (key.search("table_") != '-1')					//if table request called
        {
          makeTable(key, val);								// call function to plot table data

        } else if (key.search("graph_") != '-1')					//if graph request called
        {

          //console.log(key+val.toSource());
          makeGraph(key, val);								// call function to plot graph data
        }
      });
    }

    //function to get chart XML node name based on sected section and chart
    function getChartXMLDataNode(contentDv, selOpt, visualType)
    {
      var selOptData = [];
      if (visualType == GRAPH_TYPE)								//if graph type called
      {
        chartXMLNode = getChartXMLNode(contentDv, selOpt);
        selOptData = AREA_JSON_DATA_OBJ[chartXMLNode];
        //console.log(chartXMLNode+selOptData.toSource());
      }

      return selOptData;
    }

    //function to get chart XML node name based on sected section and chart
    function getChartXMLNode(chartDiv, otherOption)
    {
      var chartXMLNode = '';

      if (otherOption != '')
      {
        chartXMLNode = chartMapConfigXMLNodeObj[chartDiv][otherOption];
      } else {
        chartXMLNode = chartMapConfigXMLNodeObj[chartDiv];
      }

      return chartXMLNode;
    }
    // get JSON object first key

    function addThousandsSeparator(value) {
      if (value !== undefined && value != '' && value != null)
      {
        //alert(value);
        return value.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
      } else {
        return value;
      }
    }
    //function to pass data into table from xml table node
    function makeTable(tblDiv, tblXMLNode)
    {
      //alert('table->  '+tblDiv+ '  src-->'+tblXMLNode.toSource());
      var tableStr = '<table width="100%" cellpadding="0" cellspacing="0" border="0" class="fnt12">';
      tableStr += '<tr><td class="txt_cntr  bd_bt" width="20%" style="font-weight:bold;">Year <span id = "ppl_tmprd"></span></td><td colspan="2" class="txt_cntr  bd_bt"  width="20%" style="font-weight:bold;"> Girls </td><td colspan="2" class="txt_cntr  bd_bt" width="20%" style="font-weight:bold;"> Boys</td></tr>';

      tableStr += '<tr><td class="txt_cntr bd_bt " width="20%"> Age group</td><td class="txt_cntr bd_bt"  width="20%"> Number </td>				<td class="txt_cntr bd_bt" width="20%">Percentage</td> <td class="txt_cntr bd_bt" width="20%"> Number</td> <td class="txt_cntr bd_bt" width="20%"> Percentage</td></tr>';

      tblData = AREA_JSON_DATA_OBJ[tblXMLNode];
      //console.log(AREA_JSON_DATA_OBJ[tblXMLNode]);

      //if bar chart data found properly
      if (tblData !== undefined && tblData != '' && tblData != null)
      {
        $(tblData.seriesData.data).each(function (i, val)
        {
          //console.log(val);
          var zebraClass = (i % 2) ? ' class="key_tbl" ' : '';

          girl_number = girl_percent = boy_number = boy_percent = '';
          if (typeof val.girl_number !== 'undefined' && val.girl_number != '' && val.girl_number != null)
            girl_number = addThousandsSeparator(val.girl_number);
          if (typeof val.girl_percent !== 'undefined' && val.girl_percent != '' && val.girl_percent != null)
            girl_percent = val.girl_percent;
          if (typeof val.boy_number !== 'undefined' && val.boy_number != '' && val.boy_number != null)
            boy_number = addThousandsSeparator(val.boy_number);
          if (typeof val.boy_percent !== 'undefined' && val.boy_percent != '' && val.boy_percent != null)
            boy_percent = val.boy_percent;

          tableStr += '<tr' + zebraClass + '><td class="txt_cntr" width="20%"> ' + val.age_group + '</td>';
          tableStr += '<td class="txt_cntr"  width="20%"> ' + girl_number + ' </td>';
          tableStr += '<td class="txt_cntr" width="20%">' + girl_percent + '</td> ';
          tableStr += '<td class="txt_cntr" width="20%"> ' + boy_number + '</td>	';
          tableStr += '<td class="txt_cntr" width="20%"> ' + boy_percent + '</td>';
          tableStr += '</tr>';
        });
      } else {
        tableStr += '<tr><td class="txt_cntr" width="100%"  colspan="5"> No data found.</td></tr>';
      }

      tableStr += '</table>';
      $('#' + tblDiv).html(tableStr);

      // Check if population source data found
      if (typeof AREA_JSON_DATA_OBJ['by_population_source'] !== 'undefined') {
        if (typeof AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceName'] !== 'undefined')
          $('#ppl_source_nm').html(AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceName']);

        if (typeof AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceTmPeriod'] !== 'undefined')
          $('#ppl_tmprd').html(AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceTmPeriod']);
      }

    }


    //bar chart
    function makeBarChart(graphDiv, selOpt)
    {
      if (graphDiv == 'graph_mrtl_status_adolescnt1')
        barChartData = getChartXMLDataNode('graph_mrtl_status_adolescnt', selOpt, GRAPH_TYPE);
      else
        barChartData = getChartXMLDataNode(graphDiv, selOpt, GRAPH_TYPE);
      //if bar chart data found properly
      if (barChartData !== undefined && barChartData != '' && barChartData != null)
      {

        var xAxisCatg = barChartData.categoryData;
        var seriesData = barChartData.seriesData;
        var minVal = 0;
        var maxVal = null;
        var tickVal = 20;

        if (graphDiv == "graph_adolescnt_mrg")
        {
          //console.log(graphDiv);
          //console.log(barChartData);
          var SeriesName2 = barChartData.seriesData[0].name;
          var new_arr1 = new Array();
          for (i = 0; i < barChartData.seriesData[1].data.length; i++)
          {
            var catg = barChartData.categoryData[i];
            var prevval = barChartData.seriesData[1].data[i];
            //seriesData[0].data[i] =seriesData[0].data[i]- seriesData[1].data[i];
            seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
            new_arr1[catg] = prevval;

          }
        } else if (graphDiv == "graph_perc_mrd_female_used_or_not_contrcptn")
        {

          var SeriesName1 = barChartData.seriesData[1].name;
          var new_arr = new Array();
          //console.log(selOpt);
          /*for (i=0; i < barChartData.seriesData[2].data.length; i++)
           {
           var catg = barChartData.categoryData[i];
           var prevval = barChartData.seriesData[2].data[i];
           seriesData[1].data[i] =seriesData[1].data[i]- seriesData[2].data[i];
           new_arr[catg] = prevval;
           }*/
          if (selOpt == 'girl_15_19' && graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19 == false)
          {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++)
            {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[2].data[i];
              //seriesData[1].data[i] =seriesData[1].data[i]- seriesData[2].data[i];
              seriesData[1].data[i] = {'y': seriesData[1].data[i] - seriesData[2].data[i], 'ry': seriesData[1].data[i]};
              new_arr[catg] = prevval;
              console.log("graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19");

              console.log("catg ");
              console.log(barChartData);
              console.log(" ");
              console.log(prevval);
            }
            graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19 = true;
          } else if (selOpt == 'girl_20_24' && graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24 == false)
          {
            //if update series only first time, for option 'all_girl_15_19'
            for (i = 0; i < barChartData.seriesData[1].data.length; i++)
            {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[2].data[i];
              seriesData[1].data[i] = {'y': seriesData[1].data[i] - seriesData[2].data[i], 'ry': seriesData[1].data[i]};
              //seriesData[1].data[i] =seriesData[1].data[i]- seriesData[2].data[i];
              new_arr[catg] = prevval;
              console.log("graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24");
              if (i == 0)
                console.log(new_arr[catg]);
            }
            graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24 = true;
          } else
          {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++)
            {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[2].data[i];
              new_arr[catg] = prevval;

            }

          }
        } else if (graphDiv == "graph_adolescnt_prg")
        {
          var SeriesName3 = barChartData.seriesData[0].name;
          var new_arr2 = new Array();
          for (i = 0; i < barChartData.seriesData[1].data.length; i++)
          {
            var catg = barChartData.categoryData[i];
            var prevval = barChartData.seriesData[1].data[i];
            seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
            //seriesData[0].data[i] =seriesData[0].data[i]- seriesData[1].data[i];
            new_arr2[catg] = prevval;
          }
        } else if (graphDiv == "graph_perc_female_sexuly_active")
        {
          if (SEL_AREA_ID == "NPL" && selOpt == 'never-married_girl_15_19')
          {
            minVal = 0;
            maxVal = 10;
            tickVal = 1;
          }
          var SeriesName4 = barChartData.seriesData[0].name;
          var new_arr3 = new Array();
          //if update series only first time, for option 'never-married_girl_15_19'
          if (selOpt == 'never-married_girl_15_19' && graph_perc_female_sexuly_active_married_girl_15_19 == false)
          {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++)
            {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[1].data[i];
              //seriesData[0].data[i] =seriesData[0].data[i]- seriesData[1].data[i];
              seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
              new_arr3[catg] = prevval;

            }
            graph_perc_female_sexuly_active_married_girl_15_19 = true;
          } else if (selOpt == 'all_girl_15_19' && graph_perc_female_sexuly_active_all_girl_15_19 == false)
          {
            //if update series only first time, for option 'all_girl_15_19'
            for (i = 0; i < barChartData.seriesData[1].data.length; i++)
            {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[1].data[i];
              // seriesData[0].data[i] =seriesData[0].data[i]- seriesData[1].data[i];
              seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
              new_arr3[catg] = prevval;

            }
            graph_perc_female_sexuly_active_all_girl_15_19 = true;
          } else
          {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++)
            {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[1].data[i];

              new_arr3[catg] = prevval;
            }
          }
        }

        var chartMarginBottom = barChartData.chartMarginBottom;
        var width = $(window).width();

        if (graphDiv == 'graph_part_resd_household_adolescnt' || graphDiv == 'graph_mrtl_status_adolescnt' || graphDiv == 'graph_adolescnt_prg' || graphDiv == 'graph_adolescnt_mrg' || graphDiv == 'graph_perc_female_sexuly_active' || graphDiv == 'graph_perc_age_diff_btwn_female_and_partnr' || graphDiv == 'graph_schl_atnd_adolescnt_male' || graphDiv == 'graph_schl_atnd_adolescnt_female') {


          if (width > 930)
            width = 470;
          else if (width > 640 && width < 800)
            width = width / 2 - 20;
          else
            width = width - 30;

          chartSettings = {
            renderTo: graphDiv,
            type: 'bar',
            width: width,
            marginBottom: chartMarginBottom,
            spacing: [0, 0, 10, 0]
          };

          // If xaxis found and its length is greater than 0 then set chart height
          if (typeof xAxisCatg != 'undefined' && xAxisCatg.length > 0) {
            chartSettings['height'] = xAxisCatg.length * 22;
          }
        } else {
          if (width > 930) {
            width = 310;
            if (graphDiv == 'graph_perc_mrd_female_used_or_not_contrcptn' || graphDiv == 'graph_perc_female_contrcptn_dmnd_unmet' || graphDiv == 'graph_perc_female_contrcptn_dmnd_met' || graphDiv == 'graph_perc_wife_think_beating_jusfd' || graphDiv == 'graph_perc_female_take_contrcptn_desc_byself_or_with_hsbnd' || graphDiv == 'graph_perc_female_have_knwldg_hiv_aids')
              width = 330;
          } else if (width > 640 && width < 800)
            width = width / 3 - 20;
          else
            width = width - 30;


          if (graphDiv == 'graph_perc_mrd_female_used_or_not_contrcptn') {
            chartSettings = {
              renderTo: graphDiv,
              type: 'bar',
              width: width,
              height: 400,
              marginBottom: chartMarginBottom,
              spacing: [0, 0, 10, 0]
            };
          } else {
            chartSettings = {
              renderTo: graphDiv,
              type: 'bar',
              width: width,
              marginBottom: chartMarginBottom,
              spacing: [0, 0, 10, 0]
            };
          }
        }


        /*if( graphDiv =='graph_adolescnt_prg' || graphDiv =='graph_adolescnt_mrg' || graphDiv == 'graph_perc_female_sexuly_active' ){//|| graphDiv == 'graph_perc_age_diff_btwn_female_and_partnr'
         chartSettings = {
         renderTo: graphDiv,
         type: 'bar',
         width: 410,
         marginBottom:chartMarginBottom,
         spacing:[0,0,10,0]
         };
         } else if(graphDiv == 'graph_schl_atnd_adolescnt_female' || graphDiv == 'graph_schl_atnd_adolescnt_male'  || graphDiv ==  'graph_mrtl_status_adolescnt' || graphDiv ==  'graph_part_resd_household_adolescnt'){
         chartSettings = {
         renderTo: graphDiv,
         type: 'bar',
         //width: 420,
         marginBottom:chartMarginBottom,
         spacing:[0,0,10,0]
         };
         }
         else if( graphDiv =='graph_perc_mrd_female_used_or_not_contrcptn' || graphDiv =='graph_perc_female_contrcptn_dmnd_unmet' || graphDiv =='graph_perc_female_contrcptn_dmnd_met' || graphDiv =='graph_perc_wife_think_beating_jusfd' || graphDiv =='graph_perc_female_take_contrcptn_desc_byself_or_with_hsbnd' || graphDiv =='graph_perc_female_have_knwldg_hiv_aids'){
         chartSettings = {
         renderTo: graphDiv,
         type: 'bar',
         width: 310,
         marginBottom:chartMarginBottom,
         spacing:[0,0,10,0]
         };
         } */



        if (!barChartData.chartTtlFlg)
        {
          var barChartTtl = '';
        } else {
          var barChartTtl = barChartData.chartTitle;
        }
        var barXAxisLabel = barChartData.XAxisLabel;
        var barYAxisLabel = barChartData.YAxisLabel;
        var legendVisibility = barChartData.legendVisibility;

        var barGroupFlg = true;
        barGroupFlg = barChartData.groupFlg;
        if (barChartData.legendClick == 'true')
          var legendClickFlag = true;
        else
          var legendClickFlag = false;
        var errFlag = barChartData.errorStatus;
        if (errFlag == "true")
        {
          window[graphDiv] = " ";
          $("#" + graphDiv).html("Data not available").css({"text-align": "center", "margin-top": "130px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
        } else
        {
          window[graphDiv] = chart = new Highcharts.Chart({
            //window[graphDiv] = new Highcharts.Chart({
            chart: chartSettings,
            credits: {
              enabled: false
            },
            exporting: {
              enabled: false
            },
            title: {
              text: '', //barChartTtl,
              style: {
                fontSize: CHART_TITLE_FONTSIZE,
                fontWeight: 'bold'
              }
            },
            xAxis: {
              categories: xAxisCatg,
              title: {
                text: barXAxisLabel,
              },
              labels: {
                style: {
                  width: 500,
                  fontSize: XAXIS_FONTSIZE
                }
              }
            },
            yAxis: {
              min: minVal,
              max: maxVal,
              tickInterval: tickVal,
              title: {
                align: 'low',
                text: barYAxisLabel, //null,
                style: {
                  fontSize: CHART_LABEL_FONTSIZE
                }
              },
              labels: {
                overflow: 'justify',
                formatter: function () {
                  return this.value;
                },
                style: {
                  fontSize: YAXIS_FONTSIZE
                }
              }
            },
            plotOptions: {
              series: {
                bar: {
                  grouping: barGroupFlg,
                  shadow: false
                },
                events: {
                  legendItemClick: function () {
                    return legendClickFlag;
                  },
                },
                dataLabels: {
                  enabled: true,
                  color: 'white',
                  overflow: 'justify',
                  formatter: function () {
                    return '';
                  },
                  style: {
                    fontSize: SERIES_ITEM_FONTSIZE
                  }
                },
                pointWidth: barChartData.pointWidth,
                stacking: barChartData.stackVal//'percent'// 'normal'
              }
            },
            tooltip: {
              /*positioner: function(boxWidth, boxHeight, point) {

               if(point.plotX>boxWidth)
               boxWidth2 = point.plotX - boxWidth;
               else
               boxWidth2 = point.plotX;
               //console.log('boxWidth--> '+boxWidth+' hght-->'+ boxHeight+ '  boxWidth22-->'+boxWidth22+point.toSource());
               return {x:boxWidth2,y:point.plotY};
               },*/
              borderRadius: 2,
              shadow: false,
              formatter: function () {
                //alert('hey');

                if (this.series.name == SeriesName1)
                {
                  if (new_arr[this.x] != null)
                  {
                    var plus = parseFloat(this.y) + parseFloat(new_arr[this.x]);
                  } else
                  {
                    var plus = parseFloat(this.y);
                  }
                } else if (this.series.name == SeriesName2)
                {
                  if (new_arr1[this.x] != null)
                  {
                    var plus = parseFloat(this.y) + parseFloat(new_arr1[this.x]);
                  } else
                  {
                    var plus = parseFloat(this.y);
                  }

                } else if (this.series.name == SeriesName3)
                {
                  if (new_arr2[this.x] != null)
                  {
                    var plus = parseFloat(this.y) + parseFloat(new_arr2[this.x]);
                  } else
                  {
                    var plus = parseFloat(this.y);
                  }

                } else if (this.series.name == SeriesName4)
                {
                  if (new_arr3[this.x] != null)
                  {
                    var plus = parseFloat(this.y) + parseFloat(new_arr3[this.x]);
                  } else
                  {
                    var plus = parseFloat(this.y);
                  }

                } else {
                  var plus = parseFloat(this.y);
                }
                //var plus =parseFloat(this.y);
                return '<b>' + this.x + '</b><br>' + this.series.name + ' : ' + plus.toFixed(1) + '%';
              }
            },
            legend: {
              reversed: true,
              padding: 5,
              //layout: 'horizontal',
              //maxHeight:20,
              shadow: false,
              enabled: legendVisibility,
              borderWidth: 0,
              borderRadius: 0,
              itemMarginTop: 2,
              itemMarginBottom: 2,
              symbolPadding: LEGENDITEM_SYMBOL_PADDING,
              symbolWidth: LEGENDITEM_SYMBOL_WIDTH,
              itemStyle: {
                fontSize: LEGENDITEM_FONTSIZE
              }
            },
            series: seriesData
          }, function (chart) {
            var extremes = this.yAxis[0].getExtremes();
            maxY = extremes.max;
            if (maxY > 100)
              chart.yAxis[0].setExtremes(0, 100);

            // Check if table container found then update table
            containerParentDivID = $('#' + graphDiv).parent("div").attr('id');
            if ($('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).length) {

              //console.log('containerParentDivID-->'+containerParentDivID+'  graphDiv-->'+graphDiv);
              //call function to get object data in tabular format
              tblContent = dfa_tableview.getDataTableContent('chart', chart, containerParentDivID, {title: {enabled: false}}, 'hosting');

              $('#' + containerParentDivID).append(tblContent);
            }
          }
          );
        }
      } else {
        window[graphDiv] = " ";
        $("#" + graphDiv).html("Data not available").css({"text-align": "center", "margin-top": "50px", "margin-bottom": "50px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
      }
    }



    //function to get table data for bar chart
    function barChartTable(chartID)
    {
      var graphObj = window[chartID];
      var tableStr = graphObj.getCSV()

      if ($('#table' + chartID).is(':visible')) {
        $('#table' + chartID).remove();
      } else {
        chartWidth = $('#' + chartID).parent().width();
        chartHeight = $('#' + chartID).height();
        //alert(chartWidth+'  chartHeight--> '+chartHeight);
        $('#' + chartID).after('<div id="table' + chartID + '" class="bartable dataTable" style="display:none;background:#fff;margin-top:20px;position:absolute;width:' + chartWidth + 'px;padding:5px;height:' + chartHeight + 'px;overflow-y: scroll;">' + tableStr + '</div>')
        $('#table' + chartID).find('tr:eq(0)').addClass('table-hader')
        $('#table' + chartID).fadeIn('medium');
      }
      return false;
    }

    //function to get selected indicator map data when site is responsive
    function getRespMapData(mapIndctData)
    {
      if (chckMapDataFlg)			//if map indicator data found
      {
        //return AREA_JSON_DATA_OBJ['by_'+MAP_DIV][mapIndctData]['seriesData'];
        return mapDisplayData[mapIndctData]['seriesData'];
      } else {									//if no map indicator data found
        return '';
      }
    }
  });

})(jQuery);
