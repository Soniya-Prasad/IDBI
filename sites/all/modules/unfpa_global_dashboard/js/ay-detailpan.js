/**
 * @file
 */

var chartMapConfigXMLNodeObj = {"map_area_indicator_data":
    {
      "perc_girl_age_20_24_mrd_bfr_18": "Percentage of women aged 20-24 who got married before age 18",
      "perc_girl_age_20_24_mrd_bfr_15": "Percentage of women aged 20-24 who got married before age 15",
      "perc_girl_age_20_24_gave_birth_bfr_18": "Percentage of women aged 20-24 who gave birth before age 18",
      "perc_girl_age_20_24_gave_birth_bfr_15": "Percentage of women aged 20-24 who gave birth before age 15",
      "perc_mrd_girl_age_15_19_using_contrcptn_mthd": "Percentage of currently married/in union females aged 15-19 who are currently using any contraceptive method",
      "perc_mrd_girl_age_15_19_using_mdrn_contrcptn_mthd": "Percentage of currently married/in union females aged 15-19 who are currently using any modern contraceptive method",
      "perc_mrd_girl_age_15_19_not_using_contrcptn_mthd": "Percentage of currently married/in union females aged 15-19 who are not currently using any contraceptive method",
      "perc_mrd_girl_age_15_19_hv_unmet_need_fml_pln": "Percentage of currently married/in union females aged 15-19 who have an unmet need for family planning",
      "perc_mrd_girl_age_15_19_contrcptn_dmnd_stsfd": "Percentage of currently married/in union females aged 15-19 who have their contraception demand satisfied",
      "perc_mrd_girl_age_20_24_using_contrcptn_mthd": "Percentage of currently married/in union females aged 20-24 who are currently using any contraceptive method",
      "perc_mrd_girl_age_20_24_using_mdrn_contrcptn_mthd": "Percentage of currently married/in union females aged 20-24 who are currently using any modern contraceptive method",
      "perc_mrd_girl_age_20_24_not_using_contrcptn_mthd": "Percentage of currently married/in union females aged 20-24 who are not currently using any contraceptive method",
      "perc_mrd_girl_age_20_24_hv_unmet_need_fml_pln": "Percentage of currently married/in union females aged 20-24 who have an unmet need for family planning",
      "perc_mrd_girl_age_20_24_contrcptn_dmnd_stsfd": "Percentage of currently married/in union females aged 20-24 who have their contraception demand satisfied",
      "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd": "Proportion of women 15-19 involved in decision making for contraceptive use",
      "perc_girl_age_20_24_take_contrcptn_desc_byself_or_with_hsbnd": "Proportion of women 20-24 involved in decision making for contraceptive use",
      "perc_girl_age_15_19_take_own_hlth_desc_byself_or_with_hsbnd": "Proportion of women 15-19 involved in decision making for own health care",
      "perc_girl_age_20_24_take_own_hlth_desc_byself_or_with_hsbnd": "Proportion of women 20-24 involved in decision making for own health care",
      "perc_girl_age_15_19_have_knwldg_hiv_aids": "Percentage of females aged 15-19 who have comprehensive Knowledge of HIV/AIDS",
      "perc_girl_age_20_24_have_knwldg_hiv_aids": "Percentage of females aged 20-24 who have comprehensive Knowledge of HIV/AIDS",
      "perc_female_ever_had_all_girl_15_19": "Percentage of girls aged 15-19 who  ever had sex",
      "perc_female_sexuly_active_all_girl_15_19": "Percentage of girls aged 15-19 who are sexually active",
      "perc_wife_think_beating_jusfd_girl_15_24": "Percentage of females aged 15-24 who think that wife beating is justified under at least one condition",
      "perc_15_24_age_diff_btwn_female_and_partnr_girl_10_or_more": "Percentage of females aged 15-24 who have a  husband/cohabiting partner 10 or more years older"
    },
  "table_ppl_dstrbtn_resd_regn_tabledata": "by_ppl_dstrbtn_resd_regn_tabledata",
  "graph_ppl_dstrbtn_resd_regn":
    {
      "girl_10_14": "by_ppl_dstrbtn_resd_regn_girl_10_14",
      "girl_15_19": "by_ppl_dstrbtn_resd_regn_girl_15_19",
      "girl_20_24": "by_ppl_dstrbtn_resd_regn_girl_20_24",
      "boy_10_14": "by_ppl_dstrbtn_resd_regn_boy_10_14",
      "boy_15_19": "by_ppl_dstrbtn_resd_regn_boy_15_19",
      "boy_20_24": "by_ppl_dstrbtn_resd_regn_boy_20_24"
    },
  "graph_part_resd_household_adolescnt":
    {
      "girl_10_14": "by_part_resd_household_adolescnt_girl_10_14",
      "boy_10_14": "by_part_resd_household_adolescnt_boy_10_14"
    },
  "graph_mrtl_status_adolescnt":
    {
      "girl_15_19": "by_mrtl_status_adolescnt_girl_15_19",
      "girl_20_24": "by_mrtl_status_adolescnt_girl_20_24"
    },
  "graph_schl_atnd_adolescnt_female":
    {
      "girl_10_14": "by_schl_atnd_adolescnt_female_girl_10_14",
      "girl_15_19": "by_schl_atnd_adolescnt_female_girl_15_19"
    },
  "graph_schl_atnd_adolescnt_male":
    {
      "boy_10_14": "by_schl_atnd_adolescnt_male_boy_10_14",
      "boy_15_19": "by_schl_atnd_adolescnt_male_boy_15_19"
    },
  "graph_adolescnt_mrg": "by_adolescnt_mrg",
  "graph_adolescnt_prg": "by_adolescnt_prg",
  "graph_perc_mrd_female_used_or_not_contrcptn":
    {
      "girl_15_19": "by_perc_mrd_female_used_or_not_contrcptn_girl_15_19",
      "girl_20_24": "by_perc_mrd_female_used_or_not_contrcptn_girl_20_24"
    },
  "graph_perc_female_contrcptn_dmnd_unmet": "by_perc_female_contrcptn_dmnd_unmet_girl_15_24",
  "graph_perc_female_contrcptn_dmnd_met": "by_perc_female_contrcptn_dmnd_met_girl_15_24",
  "graph_perc_female_sexuly_active":
    {
      "all_girl_15_19": "by_perc_female_sexuly_active_all_girl_15_19",
      "never-married_girl_15_19": "by_perc_female_sexuly_active_never-married_girl_15_19",
    },
  "graph_perc_age_diff_btwn_female_and_partnr": "by_perc_age_diff_btwn_female_and_partnr_girl_15_24",
  "graph_perc_wife_think_beating_jusfd": "by_perc_wife_think_beating_jusfd_girl_15_24",
  "graph_perc_female_take_contrcptn_desc_byself_or_with_hsbnd": "by_perc_female_take_contrcptn_desc_byself_or_with_hsbnd_girl_15_24",
  "graph_perc_female_have_knwldg_hiv_aids": "by_perc_female_have_knwldg_hiv_aids_girl_15_24"
};
// Array of indicators lies in the category where loe is good.
var IndLowerIsGood =
  {
    "perc_mrd_girl_age_15_19_using_contrcptn_mthd": "perc_mrd_girl_age_15_19_using_contrcptn_mthd",
    "perc_mrd_girl_age_15_19_using_mdrn_contrcptn_mthd": "perc_mrd_girl_age_15_19_using_mdrn_contrcptn_mthd",
    "perc_mrd_girl_age_20_24_using_contrcptn_mthd": "perc_mrd_girl_age_20_24_using_contrcptn_mthd",
    "perc_mrd_girl_age_20_24_using_mdrn_contrcptn_mthd": "perc_mrd_girl_age_20_24_using_mdrn_contrcptn_mthd",
    "perc_mrd_girl_age_15_19_contrcptn_dmnd_stsfd": "perc_mrd_girl_age_15_19_contrcptn_dmnd_stsfd",
    "perc_mrd_girl_age_20_24_contrcptn_dmnd_stsfd": "perc_mrd_girl_age_20_24_contrcptn_dmnd_stsfd",
    "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd": "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd",
    "perc_girl_age_20_24_take_contrcptn_desc_byself_or_with_hsbnd": "perc_girl_age_20_24_take_contrcptn_desc_byself_or_with_hsbnd",
    "perc_girl_age_15_19_take_own_hlth_desc_byself_or_with_hsbnd": "perc_girl_age_15_19_take_own_hlth_desc_byself_or_with_hsbnd",
    "perc_girl_age_20_24_take_own_hlth_desc_byself_or_with_hsbnd": "perc_girl_age_20_24_take_own_hlth_desc_byself_or_with_hsbnd",
    "perc_girl_age_15_19_have_knwldg_hiv_aids": "perc_girl_age_15_19_have_knwldg_hiv_aids",
    "perc_girl_age_20_24_have_knwldg_hiv_aids": "perc_girl_age_20_24_have_knwldg_hiv_aids"
  }
// Get pie chart div.
var PIE_CHART_DIV_1 = 'graph_ppl_dstrbtn_resd_regn';
var MAP_DIV = 'map_area_indicator_data';
// Set deafut map indicator.
var DEFULT_MAP_INDCTR = 'perc_girl_age_20_24_mrd_bfr_18';
// First time map loader flag.
var mapLoadedFlg = false;
// Full screen flag.
var IconImgFlag = false;
// Get graph type.
var MAP_TYPE = 'map';
// Get graph type.
var GRAPH_TYPE = 'graph';
// Get graph type.
var TBL_TYPE = 'table';
var CHART_TITLE_FONTSIZE = 12;
// Var CHART_LABEL_COLOR = '#000000';.
var TOOLTIP_FONTSIZE = '11px';
var XAXIS_FONTSIZE = '9px';
var YAXIS_FONTSIZE = '9px';
var SERIES_ITEM_FONTSIZE = '9px';
var LEGENDITEM_FONTSIZE = '10px';
var LEGENDITEM_SYMBOL_PADDING = 2;
var LEGENDITEM_SYMBOL_WIDTH = 10;
var CHART_LABEL_FONTSIZE = '11px';
var CHART_LABEL_COLOR = '#000000';
var CHART_FONT_FAMILY = 'Verdana';
var graph_perc_female_sexuly_active_married_girl_15_19 = false;
var graph_perc_female_sexuly_active_all_girl_15_19 = false;
var graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19 = false;
var graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24 = false;
var mapLoadedFlg = false;
var map_title = "";
var EXPORT_MENU = '<div class="grapTypesMenu rnded_crnrs smlBox"><a href="javascript:void(\'0\');" class="export" type="pdf">PDF</a><br><a class="export" type="png" href="javascript:void(\'0\');">PNG</a><br><a class="export" href="javascript:void(\'0\');" type="jpeg" >JPEG</a><br><a class="export" href="javascript:void(\'0\');" type="svg" >SVG</a></div>';
var MAPS_API_URL = "http://admin.unfpaopendata.org/api/data?db=2&map=true&area=";
var country_code = "";
var country_name = "";
(function ($) {

  Drupal.behaviors.cc = {
    attach: function (context, settings) {
      allareaLevel5 = Drupal.settings.allareaLevel5;
      country_code = Drupal.settings.country_code;
      filexistAreaIdStatus = Drupal.settings.fileMapDataAreaIdJsonStatus;
      mapDisplayData = Drupal.settings.mapDisplayData;
      country_name = Drupal.settings.country_name;
    }
  };
  $(document).ready(function () {
    SERVER_NAME = window.location.host;
    SEL_AREA_ID = country_code;

    // Fetch data in AREA_JSON_DATA_OBJ
    var country_path = Drupal.settings.basePath + "jsondata/" + country_code;
    var request = new XMLHttpRequest();
    request.open("GET", country_path, false);
    request.send(null);
    var AREA_JSON_DATA_OBJ = JSON.parse(request.responseText);

    $.each(chartMapConfigXMLNodeObj["map_area_indicator_data"], function (node, name) {
      // we cant change below because what will happen when no file exists

      if (AREA_JSON_DATA_OBJ["by_map_area_indicator_data"][node]['seriesData'] != "")
      {
        mapLoadedFlg = true;
        chckMapDataFlg = true;
      }
    });

    // Pie chart filter label
    $('#sel_ppl_dstrbtn_resd_regn_radio label').click(function () {
      $(this).siblings().children('.iCheck-helper').attr("checked", true).trigger("click");
    });

    // Pie chart filter radio btn
    $('#sel_ppl_dstrbtn_resd_regn_radio .iCheck-helper').click(function () {
      piechart_filter = $(this).siblings().val();
      makePieChart('graph_ppl_dstrbtn_resd_regn', piechart_filter);
    });

    // Graph button
    $('.graph').click(function () {
      $(this).parents('.dashboard-country-outer-box').find('.action-link-list .download').css('display', 'block');
      $(this).parents('.dashboard-country-outer-box').find('.table').addClass("graph_table");
      $(this).siblings().removeClass('active');
      $(this).addClass('active');
      $(this).parent().siblings().find('.square-input-element').css('display', 'none');
      $(this).addClass("active");
      if (($(this).prop('name')) != "") {
        graphfilter_divclass = '.' + $(this).prop('name');
        $(graphfilter_divclass).css('display', 'block');
      }
      $(this).parents('.country-chart-section-left').siblings('.country-chart-section-right').find('.bar_chart').css('display', 'none');
      $(this).parents('.country-chart-section-left').siblings('.country-chart-section-right').find('.map_part').css('display', 'none');
      $(this).parents('.country-chart-section-left').siblings('.country-chart-section-right').find('.dfapi-visTbl-container').css('display', 'none');
      graph_class = '.' + $(this).prop('id');
      $(graph_class).css('display', 'block');
    });

    // Map button
    $('.map').click(function () {
      $(this).parents('.dashboard-country-outer-box').find('.action-link-list .download').css('display', 'block');
      $(this).parents('.dashboard-country-outer-box').find('.table').removeClass("graph_table");
      $(this).parents('.dashboard-country-outer-box').find('.table').addClass("map_table");
      $(this).parent().siblings().find('.square-input-element').css('display', 'none');
      $(this).siblings().removeClass('active');
      $(this).addClass('active');
      if (($(this).prop('id')) != "") {
        filter_divclass = '.' + $(this).prop('id');
        $(filter_divclass).css('display', 'block');
        $(filter_divclass).find('.first').siblings().attr("checked", true).trigger("click");
      }
      $(this).parents('.dashboard-country-outer-box').find('.map_part').css("display", "block");
      $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').css("display", "none");
      $(this).parents('.dashboard-country-outer-box').find('.bar_chart').css('display', 'none');
    });
    // Table button
    $('.map_table').click(function () {

      $(this).siblings().removeClass('active');
      $(this).addClass('active');
      if ($(this).hasClass("graph_table")) {
        debugger;
        class_bar_chart_table = '.' + $(this).prop('id');
        var visDivID = containerParentDivID = null;
        window[visDivID] = null;
        visDivID = $(class_bar_chart_table).attr('id');
        containerParentDivID = $(class_bar_chart_table).parent("div").attr('id');
        //console.log(containerParentDivID+'  '+visDivID);
        var objType = 'chart';

        // get chart object
        var obj = jQuery.extend(true, {}, window[visDivID]);
        objTblSettings = {title: {enabled: false}};
        calledSec = 'hosting';
        //  if (!$('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).length)
        //  {
        //call function to get object data in tabular format
        tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);
        $('#' + containerParentDivID).append(tblContent);
        $('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).hide();
        if ($('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).css('display') == 'none') {

          $('#' + visDivID).css('display', 'block');
          $('#' + containerParentDivID + ' div.dfapi-visTbl-container').css('display', 'block');
        } else
        {
          $('#' + containerParentDivID + ' div.dfapi-visTbl-container').css('display', 'none');
          $('#' + visDivID).css('display', 'none');
        }
        $('div.dfapi-visTbl-container').css('height', 'auto');
        // call function to enable sorting of table
        dfa_tableview.enableTableSorting(containerParentDivID);
      } else
      {
        divid = '#' + $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        containerid = '#' + $(this).parents('.dashboard-country-outer-box').find('.map_part').parent().prop('id');
        // if selected parent container already contain visualization table content
        if ($(containerid).find($('div.dfapi-visTbl-container')).length)
        {
          $(containerid).find($('div.dfapi-visTbl-container')).remove();
          $(divid).css("display", "block");
        }

        var visDivID = containerParentDivID = null;
        window[visDivID] = null;
        // get chart parent container div id
        //var containerParentDivID = $(this).parent().next('div').attr('id');
        // get chart container div id
        //visDivID = 'map_area_indicator_data';
        visDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        mapdivid = '#' + $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        containerParentDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').parent().prop('id');
        // visualization object type
        //var objType = 'chart'; //$(this).closest('div.bigdiv').children().find('div').attr('class');
        if (visDivID == $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id')) {
          objType = 'map';
        } else {
          chartTitle = 'test'; //mainObj[visDivID].chartTitle;
        }

        // get chart object
        var obj = window[visDivID];
        //console.log ("Chart Container: " + visDivID + "\nChart Container Parent: " + containerParentDivID+'  objType-->'+objType);

        if (!$(containerid).find($('div.dfapi-visTbl-container')).length)
        {
          objTblSettings = {title: {enabled: false}};
          calledSec = 'hosting';
          //call function to get object data in tabular format
          tblContent = dfa_tableview.getDataTableContent(objType, obj, containerParentDivID, objTblSettings, calledSec);
          //alert(tblContent);
          $(containerid).append(tblContent);
          //$('#mapDivId').hide();
          $(containerid).find($('div.dfapi-visTbl-container')).hide();
        }
        if ($(containerid).find($('div.dfapi-visTbl-container')).css('display') == 'none') {
          $(mapdivid).css('display', 'block');
          $(containerid + ' div.dfapi-visTbl-container').css('display', 'block');
          $('.dfapi_hcnav_medium_con').hide();
        } else
        {
          $(containerid + ' div.dfapi-visTbl-container').css('display', 'none');
          $(mapdivid).css('display', 'none');
          $('.dfapi_hcnav_medium_con').show();
        }

        // call function to enable sorting of table
        dfa_tableview.enableTableSorting(containerParentDivID);
      }


      $(this).parents('.dashboard-country-outer-box').find('.bar_chart').css("display", "none");
      $(this).parents('.dashboard-country-outer-box').find('.map_part').css("display", "none");
      $(this).parent().siblings().find('.square-input-element').css('display', 'none');
    });

    // Indicators label
    $('.dashboard-country-outer-box label').click(function () {
      $(this).siblings().children('.iCheck-helper').attr("checked", true).trigger("click");
    });

    // Indicators radio button
    $('.dashboard-country-outer-box .iCheck-helper').click(function () {
      if (($(this).parents('.dashboard-country-outer-box').prop('id')) != 'population-distribution-section') {
        // If indicator is not filter
        if (($(this).parent().parent().parent().prop('className')) != 'filter-option') {
          labeltext = $(this).parent().siblings().html();
          $(this).parents('.dashboard-country-outer-box').find('h2').html(labeltext);
          //graph button
          filterdivclass = 'filter_' + $(this).siblings().prop('className');
          graphfilterdivclass = 'graphfilter_' + $(this).siblings().prop('className');
          $(this).parents('.dashboard-country-outer-box').find('.map').prop('id', filterdivclass);
          $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('name', graphfilterdivclass);
          $(this).parents('.dashboard-country-outer-box').find('.map').click();
          id_for_chart_button = 'graph_' + $(this).siblings().prop('className');
          $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('id', id_for_chart_button);
          $(this).parents('.dashboard-country-outer-box').find('.square-input-element').css('display', 'none');
          filter_class = '.filter_' + ($(this).siblings().prop("className"));
          $(filter_class).css('display', 'block');
          // Graph table id add
          generate_id_fr_graph_btn_bar_table = 'table_' + $(this).siblings().prop('className');
          $(this).parents('.dashboard-country-outer-box').find('.table').prop('id', generate_id_fr_graph_btn_bar_table);
        }
        if (($(this).parent().parent().parent().prop('className')) == 'filter-option') {
          labeltext = $(this).parent().siblings('span').html();
          $(this).parents('.dashboard-country-outer-box').find('h2').html(labeltext);
          $(this).parents('.dashboard-country-outer-box').find('.map_part').css("display", "block");
          $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').css("display", "none");
        }
        // Filter for graph
        if ($(this).parents('.square-input-element').hasClass('graphfilter')) {
          graph_filter_value = $(this).siblings().val();
          // Call function to make Bar Chart.
          barclass_graphfilter = '.' + $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('id');
          graphid = $(barclass_graphfilter).prop('id');
          makeBarChart(graphid, graph_filter_value);
          // If bar chart data found properly.
          if (barChartData !== undefined && barChartData != '' && barChartData != null) {
            $('#title_div').html(barChartData.chartTitle);
          }

          $(this).parents('.dashboard-country-outer-box').find('.map_part').css("display", "none");
          $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').css('display', 'none');
          graphid = '.' + $(this).parents('.dashboard-country-outer-box').find('.graph').prop('id');
          $(graphid).css('display', 'block');
        } else {
          if (mapLoadedFlg)	//if map has been loaded properly
          {
            // if selected parent container already contain visualization table content
            if ($(this).parents('dashboard-country-outer-box').find('#map_render').find($('div.dfapi-visTbl-container')).length)
            {
              $(this).parents('dashboard-country-outer-box').find('#map_render').find($('div.dfapi-visTbl-container')).remove();
              $(this).parents('dashboard-country-outer-box').find('#map_area_indicator_data').css("display", "block");
              $(this).parents('dashboard-country-outer-box').find('#map_area_indicator_data_adolescent_prg').css("display", "block");
            }

            selOpt = $(this).siblings().val();
            map_title = selOpt;
            //call function to change map data
            ChangeLegend(selOpt);
            div_var = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
            if (filexistAreaIdStatus == true) {
              var mapData = getMapData(selOpt);
            } else
            {
              var mapData = getApidata(selOpt);
            }

            loadHCMapData(mapGeojson, mapData, div_var);
          }
        }
      }
    });
//    //click events of zoom in, zoom out and full extend
//    $('.dfapi_hcnav_medium_con .dfapi_hcnav_big').on('click', function () {
//
//      var hcmapobj = window['map_area_indicator_data'];
//      if ($(this).hasClass('zoomin')) {
//        hcmapobj.mapZoom(0.5); // Zoom In
//      } else if ($(this).hasClass('zoomout')) {
//        hcmapobj.mapZoom(2); // Zoom Out
//      } else if ($(this).hasClass('fulextend')) {
//        hcmapobj.mapZoom(); // full extend
//      }
//    });

    // Print Map, Graph, Table
    $('.dfapi-viz-toolbar .dfapi-viz-toolbar-medium').on('click', function () {

      if ($(this).hasClass('print'))
      {
        print_logo = "<div class='logo-unfpa'>";
        copyright_text = "<div class='copyright_content'>(c) United Nations Population Fund</div>";
        print_title = "<h2>Adolescents and Youth Dashboard - " + country_name + "</h2>";
        // Print Graph
        if ($(this).parents('.dashboard-country-outer-box').find('button.graph').hasClass('active')) {
          graph_id = '.' + $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('id');
          graph_divid = '#' + $(graph_id).prop('id');
          var objType = 'chart';

          $(this).parents('.dashboard-country-outer-box').find(graph_divid).parent().find('.print-subtitle').before(print_logo);
          $(this).parents('.dashboard-country-outer-box').find(graph_divid).after(copyright_text);
          $(this).parents('.dashboard-country-outer-box').find(graph_divid).parent().find('.print-subtitle').before(print_title);
          $(this).parents('.dashboard-country-outer-box').find(graph_divid).parent().find('.print-subtitle').css('display', 'block');
          var containerParentDivID = $(graph_divid).parent().prop('id');
        } else if ($(this).parents('.dashboard-country-outer-box').find('button.table').hasClass('active')) { // Print Table
          //('table').css('background-color', '#C16B06');
          $('table, table th, table td').css('border', '1px solid #000000');
          $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').parent().find('.print-subtitle').before(print_logo);
          $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').after(copyright_text);
          $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').parent().find('.print-subtitle').before(print_title);
          $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').parent().find('.print-subtitle').css('display', 'block');
          var containerParentDivID = $(this).parents('.dashboard-country-outer-box').find('.dfapi-visTbl-container').parent().prop('id');
          var objType = 'chart';
        } else { // Print Map
          $(this).parents('.dashboard-country-outer-box').find('.map_part').parent().find('.print-subtitle').before(print_logo);
          $(this).parents('.dashboard-country-outer-box').find('.map_part').after(copyright_text);
          $(this).parents('.dashboard-country-outer-box').find('.map_part').parent().find('.print-subtitle').before(print_title);
          $(this).parents('.dashboard-country-outer-box').find('.map_part').parent().find('.print-subtitle').css('display', 'block');
          var containerParentDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').parent().prop('id');
          var objType = 'map';
        }
        dfa_printvisualization.print(objType, containerParentDivID);
        $('.print-title').css('display', 'none');
        $('.print-subtitle').css('display', 'none');
        $('table, table th, table td').css('border', '0 none');
        window.location.reload(true);
      }
    });

// Download Map, Graph, Table
    $('.dwnld-opts a').on('click', function () {
      // Download Graph
      if ($(this).parents('.dashboard-country-outer-box').find('button.graph').hasClass('active')) {
        graph_id = '.' + $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('id');
        graph_divid = '#' + $(graph_id).prop('id');
        var objType = 'chart';
        var chartID = $(graph_id).prop('id');
        $('#' + chartID).css('width', '10px');
        var type = $(this).attr('type');
        var chartDiv = $(chartID);

        if (type == 'csv') {
          var chart = $('#' + chartID).highcharts();
          console.log("graphchart");
          console.log(chart);

          $(this).attr('href', 'data:text/csv;charset=utf-8,' + escape(chart.getCSV()));
          $(this).attr('download', "data-visualisation.csv");


        } else {
          $('#container').highcharts({
            exporting: {
              chartOptions: {
                chart: {
                  events: {
                    load: function () {
                      this.renderer.image('http://highcharts.com/demo/gfx/sun.png', 100, 100, 30, 30)
                        .add();
                    }
                  }
                }
              }
            }
          });
          var graphObj = window[chartID];
          var selOptData = [];
          selOptId = chartID.replace("graph_", "sel_");
          selGraphOpt = '';
          var catRev = ($.trim(graphObj.series[0].chart.xAxis[0].reversed)) ? graphObj.series[0].chart.xAxis[0].reversed : false;
          var serType = ($.trim(graphObj.options.chart.defaultSeriesType)) ? graphObj.options.chart.defaultSeriesType : false;
          var stackFlag = $.trim(graphObj.options.plotOptions.column.stacking);
          if (stackFlag == 'true') {
            serType = 'stacked';
          }

          if (graphObj.options.plotOptions.column.scatterLine == true) {
            serType = 'scatterLine';
          }

          var fileType = 'application/pdf';
          if (type == 'jpeg')
            fileType = 'image/jpeg';
          else if (type == 'png')
            fileType = 'image/png';
          else if (type == 'svg')
            fileType = 'image/svg+xml';
          chartTitle = "Adolescents and Youth Dashboard - " + country_name;
          var title = chartTitle;
          var fName = country_name;
          var subtitle_text = $(this).parents('.dashboard-country-outer-box').find('.dashboard-country-chart-section-title').html();
          titleprop = {text: title, style: {fontSize: '14px', color: '#3E576F'}, useHTML: true};
          graphObj.exportChart({
            type: fileType
            , filename: fName //areaName - chart title(alphabets only).pdf
          },
            {title: titleprop, subtitle: {text: subtitle_text, style: {fontSize: '11px'}}, legend: {title: '', y: 0}}
          );
          return false;
        }
      } else { // Download Map
        // get chart container div id
        var visDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');

        var fileType = this.type;
        if (fileType == 'csv') {

          var chart = $('#' + visDivID).highcharts();
          $(this).attr('href', 'data:text/csv;charset=utf-8,' + escape(chart.getCSV()));
          $(this).attr('download', "data-visualisation.csv");




        } else {
          // visualization object type
          var objType = 'map';
          // get visualization object
          var obj = window[visDivID];
          //Chart Title
          var chartTitle = '';
          var subtitle = $('#country_name h3').text();
          if (visDivID == 'map_area_indicator_data')
          {
            objType = 'map';
            chartTitle = 'Prevalence of Female Genital Mutilation (FGM) among Women Aged 15-49';
          }

          chartTitle = "Adolescents and Youth Dashboard - " + country_name;
          subtitle = $(this).parents('.dashboard-country-outer-box').find('.dashboard-country-chart-section-title').html();
          // different file format (png, jpeg, svg and pdf) can be used

          // Filename
          mapfilename = country_name;
          // name of file to be used while downloading
          var selVisFileName = 'chart';
          // apply visualization additional settings like title, subtile before to download
          objDwnldSettings = {};
          if (objType == 'chart')
          {
            objDwnldSettings = {title: {text: chartTitle, style: {'font-size': '11px', 'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif', 'color': '#3C3C3C', 'fontWeight': 'bold'}, subtitle: {enabled: true}}};
          } else if (objType == 'map')
          {
            selVisFileName = 'map';
            objDwnldSettings = {
              'title': {
                'text': chartTitle,
                'style': {
                  'font-size': '14px',
                  'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
                  'fill': '#3C3C3C',
                  'color': '#3C3C3C',
                  'fontWeight': 'bold'
                }
              },
              'subtitle': {
                'text': subtitle,
                'style': {
                  'font-size': '11px',
                  'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
                  'fill': '#3C3C3C',
                  'color': '#3C3C3C',
                  'fontWeight': 'bold'
                }
              }
            };
          }

          dfa_dwnldvisualization.download(objType, obj, selVisFileName, fileType, objDwnldSettings, mapfilename);
        }
      }
    });

    // Fullscreen Showchart
    showChart = function (obj, objSettings) {
      this.containerWidth = '';
      //Set variables to use later for undo of full screen

      //Getting visualization container width
      this.containerWidth = obj.chartWidth;
      //Getting visualization container height
      this.containerHeight = obj.chartHeight;
      //Getting chart title properties
      this.titleProperties = dfa_fullscreen.getChartTitleProperties('title', obj);
      //Getting chart subtitle properties
      this.subTitleProperties = dfa_fullscreen.getChartTitleProperties('subtitle', obj);
      //Getting chart original legend settings used to restore legend
      this.legendOldSettings = obj.legend;
      //Getting chart x-axis and y-axis properties
      var xAxisChartProperties = dfa_fullscreen.getChartAxisproperties(obj, 'xAxis', objSettings.xAxis);
      var yAxisChartProperties = dfa_fullscreen.getChartAxisproperties(obj, 'yAxis', objSettings.yAxis);
      //Getting chart data labels properties
      var dataLabelsProperties = dfa_fullscreen.getChartDataLblProperties(obj);
      //Getting chart parent container width and height to use later for undo of full screen
      var containerParentDivWidth = dfa_fullscreen.fullScreenContDivIDObj.width();
      var containerParentDivHeight = dfa_fullscreen.fullScreenContDivIDObj.height();
      /*
       * $ Blocking function to masking/unmasking screen when on/off fullscreen
       */
      $.blockUI({
        //Container Parent div object
        message: dfa_fullscreen.fullScreenContDivIDObj,
        //Deafult css to be used for masking
        css: {
          top: '0%', left: '', right: '0px', width: '100%', height: '100%', cursor: 'auto'
        },
        //When page is blocked to show full screen
        onBlock: function () {
          graph_id = '.' + $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('id');
          var chartId = $(graph_id).prop('id');
//
//          var graphObj = window[chartId];
          //Call function to add export options
          dfa_fullscreen.addExportOptions();
          //Call function to save new chart settings
          dfa_fullscreen.saveChartNewSettings();
          //Set chart size as per as full screen
          if (!dfa_fullscreen.viewTblDfltFlg)				//if by default table view is not on
            dfa_fullscreen.obj.setSize(dfa_fullscreen.fullScreenContDivIDObj.width(), dfa_fullscreen.fullScreenContDivIDObj.height(), true);
          //Call function to add share options
          if (dfa_fullscreen.objShareOptions.enabled)
            dfa_fullscreen.addShareOptions();
          //Call function to view chart data in table format
          if (dfa_fullscreen.viewTblDfltFlg)				//if by default table view is on
            dfa_fullscreen.viewTable();
          $('#TblDtVw').css({'margin-top': '0px'});
          $('#visTblDvId').css({'margin-top': '0px'});
          if (chartId == 'CO2')
          {
            $('#CO2').css({'margin': '3px'});
            graphObj.setTitle({
              y: 0
            });
          }
          return false;
        },
        // when page is unblocked to hide full screen
        onUnblock: function () {

          // Reset the size of graph
          chartid = $('#dfapi-fs-outer-container').find('.bar_chart').prop('id');
          if (chartid !== undefined)
            $('#' + chartid).highcharts().setSize('600', '400');
          // Reset the Map
          if ($('#dfapi-fs-outer-container').children('div').hasClass('map_part')) {
            map_id = $('#dfapi-fs-outer-container').children('div.map_part').prop('id');
            mapbutton_id = $('#' + map_id).parents('.dashboard-country-outer-box').find('button.map').prop('id');
            indicator_class = mapbutton_id.replace('filter_', '');
            $('.' + indicator_class).siblings().attr("checked", true).trigger("click");
            if (indicator_class == 'ay_adolescent_age_by_18_15')
            {
              $('#filter_ay_adolescent_age_by_18_15').click();
            }
            if ($('.dashboard-country-outer-box button').hasClass('active')) {
              debugger;
              button_id = $('.dashboard-country-outer-box button.active').prop('id');
              $('#' + button_id).click();
            }
          }// Reset the graph
          else if ($('#dfapi-fs-outer-container').children('div').children('div').hasClass('bar_chart')) {

            $('.highcharts-title').hide();
            bar_id = $('#dfapi-fs-outer-container').children('div').children('div.bar_chart').prop('id');
            $('#' + bar_id).parents('.dashboard-country-outer-box').find('button.graph').click();
            if ($('.dashboard-country-outer-box button').hasClass('active')) {
              debugger;
              button_id = $('.dashboard-country-outer-box button.active').prop('id');
              $('#' + button_id).click();
            }
          } else
          {

            // Reset the table
            chartid = $('#dfapi-fs-outer-container').find('.bar_chart').prop('id');
            var cnt = $("#dfapi-fs-outer-container").contents();
            $("#dfapi-fs-outer-container").parent().replaceWith(cnt);
            $('#' + chartid).parents('.dashboard-country-outer-box').find('button.table').click();
            if ($('.dashboard-country-outer-box button').hasClass('active')) {
              debugger;
              button_id = $('.dashboard-country-outer-box button.active').prop('id');
              $('#' + button_id).click();
            }

            $('#' + chartid).find('.highcharts-title').css('display', 'none');
            $('.fullscreen-table-title').css('display', 'none');
            $('.fls-tbl-title').css('display', 'none');

          }

          // Remove fullscreen outer div
          var cnt = $("#dfapi-fs-outer-container").contents();
          $("#dfapi-fs-outer-container").parent().replaceWith(cnt);
          map_title = "";

          return false;
        }
      });
    }
    /**
     * function to close full screen
     */
    closeFullScreen = function ()
    {
      debugger;
      tableScreenFlg = false;
      //Remove full screen realted divs
      if ($("#visTblDvId").length)
        $("#visTblDvId").remove();
      if ($('div.dfapi-share-box').length)
        $('div.dfapi-share-box').remove();
      if ($('div.dfapi-action-box').length)
        $('div.dfapi-action-box').remove();
      debugger;
      // Call unmasking
      //jQuery.unblockUI();
      $.unblockUI();
    }
    //Full Screen
    $('.fullscreen').on('click', function () {
      var containerParentDivID = visDivID = obj = window_height = null;
      var window_height = $(window).height();
      // Hide scroll bar in full screen
      $('html').css('overflow', 'hidden');
      var chartTitle = '';
      // Fullscreen container Map
      if ($(this).parents('.dashboard-country-outer-box').find('button.map').hasClass('active')) {

        var containerParentDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        var visDivID = $(this).parents('.dashboard-country-outer-box').find('.map_part').prop('id');
        console.log("h2");
        console.log($(this).parents('.dashboard-country-outer-box').find('.dashboard-country-chart-section-title').html());
        if (map_title == "")
          map_title = visDivID;
        console.log("title");
        console.log(map_title);
      }

      // Fullscreen container Graph
      if ($(this).parents('.dashboard-country-outer-box').find('button.graph').hasClass('active')) {
        graph_id = '.' + $(this).parents('.dashboard-country-outer-box').find('button.graph').prop('id');
        graph_divid = '#' + $(graph_id).prop('id');
        var objType = 'chart';
        var containerParentDivID = $(graph_divid).parent().prop('id');
        visDivID = $(graph_id).prop('id');
        chartId = visDivID;
      }

      // Fullscreen container Table
      if ($(this).parents('.dashboard-country-outer-box').find('button.table').hasClass('active')) {
        table_id = '.' + $(this).parents('.dashboard-country-outer-box').find('button.table').prop('id');
        table_divid = '#' + $(table_id).prop('id');
        var objType = 'chart';
        tableparentid = $(table_divid).parent().prop('id');
        var containerParentDivID = $(table_id).prop('id');
        visDivID = $(table_id).prop('id');
      }

      chartTitle = $(this).parents('.dashboard-country-outer-box').find('.dashboard-country-chart-section-title').html();
      $('.fullscreen-table-title').html(chartTitle);
      $('#' + containerParentDivID).find($('div.dfapi_chartTbl')).hide();
      var subgp = $('#' + visDivID).parent().parent().find('.dd-selected-text').html();
      if ($.trim(subgp) != '')
      {
        var chartTitle = chartTitle + ' ,' + subgp;
      }

      // visualization object type
      var objType = 'chart';
      var obj = window[visDivID];
      // visualization object type
      var objType = 'chart';
      var obj = window[visDivID];
      //var subtitle_text =  ' ';
      var subtitle_text = $('.top h3').text();
      if (visDivID == 'mapDivId') {
        objType = 'map';
        // chartTitle = Ind_Name;
        //chartTitle = $('#Ind_Name').html();
      } else {
        objType == 'chart';
        //console.log(chartTitle);
      }

      // get chart object
      if (objType == 'chart') {
        // visualization object new/additional settings for full screeen
        var objSettings = {
          'title': {
            'text': chartTitle,
            'align': 'center',
            'style': {
              'color': '#666666',
              'fontWeight': 'bold',
              'font-size': '12px',
              'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
            }
          },
          'subtitle': {
            'enabled': true,
            'text': subtitle_text,
            'align': 'center',
            'style': {
              'color': '#666666',
              'fontWeight': 'bold',
              'font-size': '9px',
              'font-family': 'Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif',
            }

          }
        };
      }

      // visualization object share options
      var objShareOptions = {
        'enabled': false,
        'url': (window.location != window.parent.location) ? document.referrer : document.location.href,
        'iconSize': 'big',
        'callback': '',
        'onmousehover': false,
        'containerParentDivID': containerParentDivID,
        'containerDivId': visDivID,
        'chartType': objType
      };
      // set flag to show table by default
      var tblDefaultOpt = true;
      if (visDivID == 'map') {

        tblDefaultOpt = false;
      }

      resetSelVisStatus(containerParentDivID, visDivID);
      //call function to show full screen
      dfa_fullscreen.show(objType, obj, containerParentDivID, objSettings, objShareOptions, tblDefaultOpt);
      $('.icon_bg').css('display', 'none');
      return false;
    });
    function resetSelVisStatus(containerParentDivID, visDivID) {
      if ($('#' + containerParentDivID).find('div.dfapi-visTbl-container').length) {
        visTblContDivID = $('#' + containerParentDivID).find('div.dfapi-visTbl-container').attr('id');
        $('#' + containerParentDivID).find($('#' + visDivID)).show();
        $('#' + containerParentDivID).find($('#' + visTblContDivID)).remove();
      }
    }

    // - Load highcharts map data
    loadHCMapData = function (mapGeojson, mapData, div_var) {

      var subtitleFlag = true;
      var dataFlag = false;
      var realData = '';
      var minData = 0;
      var maxData = 100;
      var realCode = '';
      var realTmp = '';
      var legendName = '';
      var realData = new Array();
      var widthVal = $('#mapDivId').width();
      if (mapData.length == 0) {
        $("#" + div_var).html("Data not available").css({"text-align": "center", "margin": "50px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
//              $("#" + div_var).html("Data not available");
      } else {
        if (typeof widthVal != 'undefined' && widthVal != 0) {
          mapWidth = widthVal;
        }
        if (mapData && RangeOnePointVal.length > 1) {
          // Check if the selected indicator is in the array IndLowerIsGood.
          if ([selOpt] in IndLowerIsGood) {
            // Legend Color Code when low is good.
            brk_colors = ['#FF552D', '#FFCC00', '#6699FF', '#0000FF'];
            var dataClassesArr = [{from: Number(RangeOnePointVal[0].toFixed(1)), to: Number(RangeOnePointVal[1].toFixed(1)), name: legend_labels[0], color: "#FF552D"}, {from: Number((RangeOnePointVal[1] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[2].toFixed(1)), name: legend_labels[1], color: "#FFCC00"}, {from: Number((RangeOnePointVal[2] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[3].toFixed(1)), name: legend_labels[2], color: "#6699FF"}, {from: Number((RangeOnePointVal[3] + 0.1).toFixed(1)), to: Number((RangeOnePointVal[3] + 0.1).toFixed(1)) + 50, name: legend_labels[3], color: "#0000FF"}];
          } else {
            // Variable for legend color array.
            brk_colors = ['#0000FF', '#6699FF', '#FFCC00', '#FF552D'];
            var dataClassesArr = [{from: Number(RangeOnePointVal[0].toFixed(1)), to: Number(RangeOnePointVal[1].toFixed(1)), name: legend_labels[0], color: "#0000FF"}, {from: Number((RangeOnePointVal[1] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[2].toFixed(1)), name: legend_labels[1], color: "#6699FF"}, {from: Number((RangeOnePointVal[2] + 0.1).toFixed(1)), to: Number(RangeOnePointVal[3].toFixed(1)), name: legend_labels[2], color: "#FFCC00"}, {from: Number((RangeOnePointVal[3] + 0.1).toFixed(1)), to: Number((RangeOnePointVal[3] + 0.1).toFixed(1)) + 50, name: legend_labels[3], color: "#FF552D"}];
          }
        } else {
          var brk_colors = [];
          var customArr = [];
        }
        // Get join by array based selected area id key in map geojson shape file.
        var joinByArr = ['ID_', 'code'];
        /*if(typeof mapGeojson.features[0].properties.ID_ !=='undefined'){
         joinByArr = ['ID_', 'code'];
         }*/
        // Initiate the chart

        window[div_var] = new Highcharts.Map({
          chart: {
            renderTo: div_var,
            borderWidth: 0,
            backgroundColor: '#fff',
            style: {
              fontFamily: '"Helvetica Neue",Helvetica,Arial,sans-serif'
            },
          },
          title: {
            text: ' ',
            style: {
              color: '#000',
              font: 'bold 14px "Helvetica Neue",Helvetica,Arial,sans-serif'
            }
          },
          subtitle: {
            useHTML: true,
            text: ' ',
            style: {
              color: '#70A7FF',
              font: 'bold 11px "Helvetica Neue",Helvetica,Arial,sans-serif'
            }
          },
          mapNavigation: {
            enabled: false,
            enableMouseWheelZoom: false,
            enableDoubleClickZoom: false,
            enableDoubleClickZoomTo: false
          },
          colorAxis: {dataClasses: dataClassesArr},
          legend: {
            layout: 'horizontal',
            align: 'center',
            verticalAlign: 'bottom',
            floating: false,
            title: {
              text: ' '
            },
            itemStyle: {
              fontWeight: '0',
              fontStyle: '"Helvetica Neue",Helvetica,Arial,sans-serif',
              color: '#7B7B7B',
              textDecoration: 'none'
            }
          },
          plotOptions: {
            series: {
              cursor: 'pointer',
              point: {
                events: {}
              }
            }
          },
          tooltip: {
            useHTML: true,
            formatter: function () {
              return this.point.properties.NAME1_ + ': ' + this.point.value + '%';
            }
          },
          exporting: {
            enabled: false,
            chartOptions: {
              chart: {
                events: {
                  load: function () {
                    this.renderer.image('https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/UNFPA_logo.svg/2000px-UNFPA_logo.svg.png', 100, 100, 30, 30)
                      .add();
                  }
                }
              }
            }
          },
          credits: {enabled: false},
          series: [{
              data: mapData,
              mapData: mapGeojson,
              name: legendName,
              allAreas: true,
              states: {
                hover: {
                  color: '#BADA55',
                }
              },
              joinBy: joinByArr,
              dataLabels: {
                enabled: true,
                formatter: function () {

                  // console.log(this);
                },
              }
            }]

        }, function (chart) {

//          chart.renderer.image('http://localhost/unfpa-global-ay/sites/all/modules/custom/unfpa_global_dashboard/images/unfpa_logo.png', 10, 0, 50, 50)
//            .add();
//          setTimeout(function () {
//          }, 100);
        });
      }
    };
    // Function to get selected indicator map data.
    function getMapData(selOpt)
    {
      // If map indicator data found.
      if (chckMapDataFlg) {
        return mapDisplayData[selOpt]['seriesData'];
      }
      // If no map indicator data found.
      else {
        return '';
      }
    }

//    if (chckMapDataFlg) {//if map indicator data found
//      selOpt = "perc_girl_age_20_24_mrd_bfr_15";
//      //selOpt = mapIndctData.selectedData.value;
//    } else {												//if map indicator data not found
//
//      var mapIndctData = [];
//      selOpt = '';
//      var RangeValArr = new Array();
//      var legend_labels = new Array();
//      var RangeOnePointVal = new Array();
//    }


//-----rendermaphighchartapi function with body
    var renderMapHighchartsAPI = function (selOpt, div_var) {

      // mapDisplayData.
      var mpdataCnt = 0;
      var allIusGids = [];
      // Case when file found.

      if (filexistAreaIdStatus == true) {
        var iusSelected = mapDisplayData[selOpt]['IUSGID'];
        // Var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&data=false&tp=mrd';.
        var callbackURL = MAPS_API_URL + allareaLevel5 + '&getChildren=no&data=false&tp=mrd';
        if (SEL_AREA_ID == 'NPL' || SEL_AREA_ID == 'SLE') {
          callbackURL += '&areaLevel=6';
          var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&' + 'data=false&tp=mrd&areaLevel=6';
        }
      } else {
        // Case when file not  found
        var iusSelected = AREA_JSON_DATA_OBJ['by_' + MAP_DIV][selOpt]['IUSGID'];
        // Get all ius gids from existing xml of area of node  map.
        var allData = AREA_JSON_DATA_OBJ['by_' + MAP_DIV];
        for (var ind in allData) {
          allIusGids[ind] = allData[ind]['IUSGID'];
        }
        var concatAllIusGid = '';
        var iusGidSelSplitall = '';
        for (i in allIusGids) {
          iusGidSelSplitall = allIusGids[i].split("||");
          concatAllIusGid += iusGidSelSplitall[0] + "," + iusGidSelSplitall[1] + "," + iusGidSelSplitall[2];
          concatAllIusGid += '{~}';
        }

        // Var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&ius=' + concatAllIusGid + '&data=true&tp=mrd';.
        var callbackURL = MAPS_API_URL + allareaLevel5 + '&getChildren=no&ius=' + concatAllIusGid + '&data=true&tp=mrd';
        // console.log('concatAllIusGid');
        // console.log(concatAllIusGid);
        if (SEL_AREA_ID == 'NPL' || SEL_AREA_ID == 'SLE') {
          callbackURL += '&areaLevel=6';
          var callbackURL = MAPS_API_URL + SEL_AREA_ID + '&getChildren=yes&ius=' + concatAllIusGid + '&data=true&tp=mrd&areaLevel=6';
        }
      }

      // SERVER_NAME = "localhost";.
      var calltype = "json";
      var concatIusGid = '';
      var n = MAPS_API_URL.indexOf(SERVER_NAME);
      if (n == -1) {
        calltype = "jsonp";
      }

      // var iusSelected = AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]['IUSGID'];
      // var iusSelected = mapDisplayData[selOpt]['IUSGID'];.
      if (iusSelected != '') {
        iusGidSelSplit = iusSelected.split("||");
        concatIusGid = iusGidSelSplit[0] + "," + iusGidSelSplit[1] + "," + iusGidSelSplit[2];
      }

      // var iusSelected = 'PRP_WMN_20-24_YR_MRD_18,PER,F_20-24_YR';
      // console.log(AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]);.
      // console.log(callbackURL);
      var mpdataCntselected = 0
      $.ajax({
        crossOrigin: true,
        type: "GET",
        url: callbackURL,
        async: false,
        data: {},
        dataType: calltype,
        beforeSend: function () {
          // showLoader();
        },
        success: function (data) {

          if ($.trim(data.map) != '') {
            // console.log('after api called ');
            // map always from api.
            mapGeojson = data.map;
            // console.log("data");.
            //console.log(mapGeojson);
            // Case below execute when file not found.
            if (filexistAreaIdStatus == false) {
              mapDatafrmApi = data.data;
              var finalMapData = [];
              var allIusData = [];
              // Prepare format of object for display data from api
              // var lengthOfApiObj =  Object.size(mapDatafrmApi);
              // console.log(lengthOfApiObj+'--lenght');
              // var maincnt=0;.
              dataformatStatus = true;
              for (var mdInd in mapDatafrmApi) {
                dataformatStatus = false;
                var selectediusFlag = false;
                if (mdInd == concatIusGid) {
                  selectediusFlag = true;
                  // console.log(mdInd+'==mdInd is the selected indicator ');.
                }
                var mpdataSecInd = mapDatafrmApi[mdInd];
                var mpdataInnerCnt = 0;
                mdIndSplit = mdInd.split(',');
                mdIndConcat = mdIndSplit[0] + '||' + mdIndSplit[1] + '||' + mdIndSplit[2];
                allIusData[mdInd] = [];
                finalMapData[mdIndConcat] = [];
                for (var mdInnerInd in mpdataSecInd) {

                  for (var mdSecondInnerInd in mpdataSecInd[mdInnerInd]) {

                    finalMapData[mdIndConcat][mpdataCnt] = [];
                    finalMapData[mdIndConcat][mpdataCnt]['code'] = mdSecondInnerInd;
                    finalMapData[mdIndConcat][mpdataCnt]['id'] = mdSecondInnerInd;
                    finalMapData[mdIndConcat][mpdataCnt]['value'] = mpdataSecInd[mdInnerInd][mdSecondInnerInd][0];
                    if (selectediusFlag == true) {
                      allIusData[mdInd][mpdataCntselected] = [];
                      allIusData[mdInd][mpdataCntselected]['code'] = mdSecondInnerInd;
                      allIusData[mdInd][mpdataCntselected]['id'] = mdSecondInnerInd;
                      allIusData[mdInd][mpdataCntselected]['value'] = mpdataSecInd[mdInnerInd][mdSecondInnerInd][0];
                      mpdataCntselected++;
                      // console.log(mpdataCntselected+'==mpdataCntselected');
                      // console.log(selectediusFlag+'==selectediusFlag');.
                    }
                    mpdataCnt++;
                  }

                }
                // maincnt++;
                // if(maincnt==lengthOfApiObj){
                // enable format status use this in file creation when whole format process completed
                // dataformatStatus=true;
                // }.
              }

              var finalMapDataObj = convArrToObj(finalMapData);
              if (finalMapDataObj != '') {
                // Preparing format process is completed to post.
                dataformatStatus = true;
              }

              // console.log('selected name=='+selOpt);
              // console.log('finalMapData');
              // console.log(finalMapData);
              // console.log(allIusData);
              var mapDataAp = allIusData[concatIusGid];
              var mpJsonObj = convArrToObj(mapDataAp);
              // Format process completed to display selected ius  data.
              var mpJsonObjtoArr = convObjToArr(mpJsonObj);
              // console.log('mapData inisde apimpJsonObjtoArr');.
//              console.log(finalMapDataObj);
              var allIusGidsObj = convArrToObj(allIusGids);
              mapData = mpJsonObjtoArr;
              // mapData=mpJsonObjtoArr;
              // create file when format process completed
              // console.log("check");
              // console.log(WEBSITE_BASE_URL);
              if (dataformatStatus == true) {
                ChangeLegend(selOpt);
                loadHCMapData(mapGeojson, mpJsonObjtoArr, div_var); //display selected ius data using api
//                $.ajax({
                //                  type: "POST",
                //                  url: WEBSITE_BASE_URL + "pages/createMapDataFile", //call to create file
                //                  async: false,
                //                  //data: {'mapdataVal': finalMapDataObj, 'allIusGids': allIusGidsObj, 'areaId': SEL_AREA_ID, 'innerMap': true}, // for inner map only
                //                  data: {'api_url': callbackURL, 'allIusGids': allIusGidsObj, 'areaId': SEL_AREA_ID, 'innerMap': true}, // for inner map only
                //                  dataType: "json",
                //                  beforeSend: function () {
                //                    //showLoader();
                //                  },
                //                  success: function (sucData) {
                //                    //console.log('File created succesfully');
                //                    //loadHCMapData(mapGeojson,sucData);
                //                  },
                //                  cache: true
                //                });.
              }

            } else {
              ChangeLegend(selOpt);
              // console.log('no api called for this case');.
              var mapData = getMapData(selOpt);
              //console.log(mapData);
              loadHCMapData(mapGeojson, mapData, div_var); //display selected ius data using api

            }

          } else {
            console.log('Map is empty');
          }

        },
        error: function (result) {
          console.log("ERROR");
        },
        cache: true
      });
    }

    //Child marriage map
    selOpt = "perc_girl_age_20_24_mrd_bfr_15";
    div_var = "map_area_indicator_data";
    renderMapHighchartsAPI(selOpt, div_var);

    // Adolescent pregnancy map
    selOpt = "perc_girl_age_20_24_gave_birth_bfr_15";
    div_var = "map_area_indicator_data_adolescent_prg";
    renderMapHighchartsAPI(selOpt, div_var);

    // Sexual reproductive map
    selOpt = "perc_girl_age_15_19_have_knwldg_hiv_aids";
    div_var = "map_area_indicator_data_sexual_reprd";
    renderMapHighchartsAPI(selOpt, div_var);

// Family planning map
    selOpt = "perc_mrd_girl_age_15_19_using_contrcptn_mthd";
    div_var = "map_area_indicator_data_family_planning";
    renderMapHighchartsAPI(selOpt, div_var);

// Gender equality map
    selOpt = "perc_girl_age_15_19_take_contrcptn_desc_byself_or_with_hsbnd";
    div_var = "map_area_indicator_data_gender_equality";
    renderMapHighchartsAPI(selOpt, div_var);

    //redrawing alll the charts when window is resized
    $(window).resize(function () {

      // Call function to pass data into map, chart and table.
      //makeMapGraphTable();
//      $(document).on('change', "#slctindi_id4", function (el) {
//        makeBarChart('graph_mrtl_status_adolescnt1', $(el.target).val());
//      });
    });
    /*
     Function to render highcharts map, map comes form database usin API
     */
    Object.size = function (obj) {
      var size = 0, key;
      for (key in obj) {
        if (obj.hasOwnProperty(key)) {
          size++;
        }
      }
      return size;
    };
    var convArrToObj = function (array) {
      var thisEleObj = new Object();
      if (typeof array == "object") {
        for (var i in array) {
          var thisEle = convArrToObj(array[i]);
          thisEleObj[i] = thisEle;
        }
      } else {
        thisEleObj = array;
      }

      return thisEleObj;
    };
    var convObjToArr = function (Obj) {
      var returArr = [];
      for (var i in Obj) {
        returArr[i] = Obj[i];
      }
      return returArr;
    };
    // Function to change map legend dyanmically.
    function ChangeLegend(selOpt) {

      if (selOpt != '') {
        if (filexistAreaIdStatus == true) {
          var dataArr = mapDisplayData[selOpt]['seriesData'];
        } else {
          var dataArr = getApidata(selOpt);
        }
        // var	dataArr = AREA_JSON_DATA_OBJ['by_'+MAP_DIV][selOpt]['seriesData'];
        // var	dataArr = mapDisplayData[selOpt]['seriesData'];
        // creating new array for min and max.
        valArr = new Array();
        $.each(dataArr, function (ID, DV) {
          // console.log(DV['value']);.
          valArr.push(DV['value']);
        });
        // Find min and max value
        // 3.
        var maxVal = Math.max.apply(Math, valArr);
        // 1.
        var minVal = Math.min.apply(Math, valArr);
        var rangeDiffVal = maxVal - minVal;
        var rangeVal = (rangeDiffVal / 4);
        // Craeting New array with values from min to max with rageVal interval.
        RangeValArr = new Array();
        for (var i = minVal; i < maxVal; i = (i + rangeVal)) {
          RangeValArr.push(i);
        }
        // if range value is greater than 1 then give range and legend label.
        if (RangeValArr.length > 1) {
          RangeOnePointVal = [RangeValArr[0], RangeValArr[1], RangeValArr[2], RangeValArr[3]];
          legend_labels = [RangeValArr[0].toFixed(1) + "% - " + RangeValArr[1].toFixed(1) + "%", (RangeValArr[1] + 0.1).toFixed(1) + "% - " + RangeValArr[2].toFixed(1) + "%", (RangeValArr[2] + 0.1).toFixed(1) + "% - " + RangeValArr[3].toFixed(1) + "%", (RangeValArr[3] + 0.1).toFixed(1) + "% and More"];
        }
      }
    }

    // Function used in cases when file does not exist and onchange of indicators data is required.
    function getApidata(selOpt) {
      mpdataCntselectedApi = 0;
      var allIusDataApi = [];
      var iusSelected = AREA_JSON_DATA_OBJ['by_' + MAP_DIV][selOpt]['IUSGID'];
      if (iusSelected != '') {
        iusGidSelSplit = iusSelected.split("||");
        concatIusGid = iusGidSelSplit[0] + "," + iusGidSelSplit[1] + "," + iusGidSelSplit[2];
      }
      for (var mdInd in mapDatafrmApi) {

        var mpdataSecIndApi = mapDatafrmApi[mdInd];
        mdIndSplitApi = mdInd.split(',');
        mdIndConcatApi = mdIndSplitApi[0] + '||' + mdIndSplitApi[1] + '||' + mdIndSplitApi[2];
        allIusDataApi[mdInd] = [];
        for (var mdInnerInd in mpdataSecIndApi) {

          for (var mdSecondInnerInd in mpdataSecIndApi[mdInnerInd]) {

            if (mdInd == concatIusGid) {
              allIusDataApi[mdInd][mpdataCntselectedApi] = [];
              allIusDataApi[mdInd][mpdataCntselectedApi]['code'] = mdSecondInnerInd;
              allIusDataApi[mdInd][mpdataCntselectedApi]['id'] = mdSecondInnerInd;
              allIusDataApi[mdInd][mpdataCntselectedApi]['value'] = mpdataSecIndApi[mdInnerInd][mdSecondInnerInd][0];
              // allIusData[mdInd]= mpdataSecIndApi;.
              mpdataCntselectedApi++;
            }
          }

        }
      }
      var mapData1 = allIusDataApi[concatIusGid];
      var mpJsonObj1 = convArrToObj(mapData1);
      var mpJsonObjtoArr1 = convObjToArr(mpJsonObj1);
      var mapData = mpJsonObjtoArr1;
      return mpJsonObjtoArr1;
    }

    //function to make pieChart
    function makePieChart(graphDiv, selOpt)
    {

      pieChartData = getChartXMLDataNode(graphDiv, selOpt, GRAPH_TYPE);
      // If pie chart data found properly.
      if (pieChartData !== undefined && pieChartData != '' && pieChartData != null) {
        var pieDataSet = pieChartData.seriesData;

        legendSettings = {
          enabled: true,
          layout: 'vertical', //vertical
          backgroundColor: '#FFFFFF',
          align: 'right',
          verticalAlign: 'middle', //middle
          floating: false,
          borderWidth: 0,
          useHTML: true,
          // x: 10,
          // y: 0,.
          borderWidth: 0,
            borderRadius: 0,
          itemMarginTop: 2,
          symbolPadding: LEGENDITEM_SYMBOL_PADDING,
          symbolWidth: LEGENDITEM_SYMBOL_WIDTH,
          itemStyle: {
            fontSize: LEGENDITEM_FONTSIZE
          },
          labelFormatter: function () {
            var legendName = this.name;
            var legendName = legendName;
            if (legendName == "Rural") {
              debugger;
              legendName = '<span>' + this.name + '</span><span style="position: relative; left: -10px; display:block; width: 100px; height: 20px; pointer-events: none; z-index: 9999;"></span>';
              this.itemMarginBottom = 10;
              window.globalVar = 10;
            } else
            {
              this.itemMarginBottom = 2;
              legendName = this.name;
              window.globalVar = 2;
            }
            return legendName;
          },
          itemMarginBottom: window.globalVar,
        };
//        }



        // set pie size attributes.
        pieDataSet[0].size = '25%';
        pieDataSet[1].innerSize = '50%';
        pieDataSet[1].size = '80%';
        // Showed urban and rural in legend.
        pieDataSet[0].showInLegend = true;
        // Set first data point label to white.
        pieDataSet[0].data[0].dataLabels = {"color": "#fff", style: {fontSize: '10px'}};
        pieDataSet[0].data[1].dataLabels = {"color": "#fff", style: {fontSize: '10px'}};
        pieDataSet[0].dataLabels = {"distance": -20, "connectorWidth": 0, "color": "#fff", style: {fontSize: '10px'}};
        var dis = '';
        var col = '';
        function setDisCol(d, c) {
          dis = d;
          col = c;
        }

        var width = $(window).width();
        if (width > 930) {
          width = 450;
        } else if (width > 640 && width < 900) {
          width = width / 2 - 20;
        } else {
          width = width - 10;
        }

        chartSettings = {
          renderTo: graphDiv,
          type: 'pie',
          height: 320,
          width: width,
        };
        // Create the chart.
        var chart = new Highcharts.Chart({
          chart: chartSettings,
          exporting:
            {
              enabled: false
            },
          legend: legendSettings,
          credits: {
            enabled: false
          },
          title: {
            text: ''
          },
          yAxis: {
            title: {
              text: ''
            }
          },
          plotOptions: {
            pie: {
              allowPointSelect: true,
              cursor: 'pointer',
              dataLabels: {
                enabled: false,
                /*distance: dis,
                 color: col,*/
                formatter: function () {
                  return this.y + '%';
                }
              },
              // showInLegend: true,
              // [left,top].
              center: ['50%', '50%']
            }},
          tooltip: {
            formatter: function () {
              return this.key + ' : ' + this.y + '%';
            }},
          series: pieDataSet
        });
      } else {
        window[graphDiv] = " ";
        $("#" + graphDiv).html("Data not available").css({"text-align": "center", "margin": "50px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
      }
    }

    getFirstOtion = function (jsonObj)
    {
      for (var propName in jsonObj) {
        if (jsonObj.hasOwnProperty(propName)) {
          // console.log(propName);
          // or do something with it and break.
          return propName;
        }
      }
    }
    // Function to pass data into graph from xml graph node.
    function makeGraph(graphDiv, graphOption)
    {
      var firstOpt = '';
      if (typeof (graphOption) == 'object') {
        // alert('object->  '+graphDiv+ '  lennn-->'+ graphOption.length+ '  typ-->'+ typeof (graphOption) + '  src-->'+graphOption.toSource());
        firstOpt = getFirstOtion(graphOption);
      } else if (typeof (graphOption) == 'string') {
        // alert('string->  '+ graphDiv+ '  lennn-->'+ graphOption.length+ '  typ-->'+ typeof (graphOption) + '  src-->'+graphOption.toSource());
      }
      // alert('firstOpt   '+firstOpt);.
      if (graphDiv == PIE_CHART_DIV_1) {
        // Call function to make pie chart.
        makePieChart(graphDiv, firstOpt);
      } else {

        // if(graphDiv !='graph_perc_female_sexuly_active' && graphDiv != 'graph_perc_mrd_female_used_or_not_contrcptn')
        // {
        // call function to make bar chart.
//        if (graphDiv !== 'graph_schl_atnd_adolescnt_male') {
//          debugger;
//          makeBarChart(graphDiv, firstOpt);
//        }
        makeBarChart(graphDiv, firstOpt);
        if (graphDiv == 'graph_mrtl_status_adolescnt') {
          makeBarChart('graph_mrtl_status_adolescnt1', 'girl_15_19');
          // console.log(firstOpt);
        }

        // }.
      }
    }
    makeMapGraphTable();
    // Intergrated function make map, graph and table.
    function makeMapGraphTable()
    {

      $.each(chartMapConfigXMLNodeObj, function (key, val) {

        // If map request called.
        if (key.search("map_") != '-1') {
          // makeMap(key);									// call function to plot map data.
        }
        // If table request called.
        else if (key.search("table_") != '-1') {
          // Call function to plot table data.
          makeTable(key, val);
        }
        // If graph request called.
        else if (key.search("graph_") != '-1') {
          // console.log(key+val.toSource());
          // call function to plot graph data.
          makeGraph(key, val);
        }
      });
    }

    // Function to get chart XML node name based on sected section and chart.
    function getChartXMLDataNode(contentDv, selOpt, visualType)
    {
      var selOptData = [];
      // If graph type called.
      if (visualType == GRAPH_TYPE) {
        chartXMLNode = getChartXMLNode(contentDv, selOpt);
        selOptData = AREA_JSON_DATA_OBJ[chartXMLNode];
        // console.log(chartXMLNode+selOptData.toSource());
      }

      return selOptData;
    }

    // Function to get chart XML node name based on sected section and chart.
    function getChartXMLNode(chartDiv, otherOption)
    {
      var chartXMLNode = '';
      if (otherOption != '') {
        chartXMLNode = chartMapConfigXMLNodeObj[chartDiv][otherOption];
      } else {
        chartXMLNode = chartMapConfigXMLNodeObj[chartDiv];
      }

      return chartXMLNode;
    }
    // Get JSON object first key.
    function addThousandsSeparator(value) {

      if (value !== undefined && value != '' && value != null) {
        // alert(value);
        return value.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
      } else {
        return value;
      }
    }
    // Function to pass data into table from xml table node.
    function makeTable(tblDiv, tblXMLNode)
    {
      // alert('table->  '+tblDiv+ '  src-->'+tblXMLNode.toSource());
      var tableStr = '<table width="100%" cellpadding="0" cellspacing="0" border="0" class="fnt12">';
      tableStr += '<tr><td class="txt_cntr  bd_bt" width="20%" style="font-weight:bold;">Year <span id = "ppl_tmprd"></span></td><td colspan="2" class="txt_cntr  bd_bt"  width="20%" style="font-weight:bold;"> Girls </td><td colspan="2" class="txt_cntr  bd_bt" width="20%" style="font-weight:bold;"> Boys</td></tr>';
      tableStr += '<tr><td class="txt_cntr bd_bt " width="20%"> Age group</td><td class="txt_cntr bd_bt"  width="20%"> Number </td>				<td class="txt_cntr bd_bt" width="20%">Percentage</td> <td class="txt_cntr bd_bt" width="20%"> Number</td> <td class="txt_cntr bd_bt" width="20%"> Percentage</td></tr>';
      tblData = AREA_JSON_DATA_OBJ[tblXMLNode];
      // console.log(AREA_JSON_DATA_OBJ[tblXMLNode]);
      // if bar chart data found properly.
      if (tblData !== undefined && tblData != '' && tblData != null) {
        $(tblData.seriesData.data).each(function (i, val)
        {
          // console.log(val);
          var zebraClass = (i % 2) ? ' class="key_tbl" ' : '';
          girl_number = girl_percent = boy_number = boy_percent = '';
          if (typeof val.girl_number !== 'undefined' && val.girl_number != '' && val.girl_number != null) {
            girl_number = addThousandsSeparator(val.girl_number);
          }
          if (typeof val.girl_percent !== 'undefined' && val.girl_percent != '' && val.girl_percent != null) {
            girl_percent = val.girl_percent;
          }
          if (typeof val.boy_number !== 'undefined' && val.boy_number != '' && val.boy_number != null) {
            boy_number = addThousandsSeparator(val.boy_number);
          }
          if (typeof val.boy_percent !== 'undefined' && val.boy_percent != '' && val.boy_percent != null) {
            boy_percent = val.boy_percent;
          }

          tableStr += '<tr' + zebraClass + '><td class="txt_cntr" width="20%"> ' + val.age_group + '</td>';
          tableStr += '<td class="txt_cntr"  width="20%"> ' + girl_number + ' </td>';
          tableStr += '<td class="txt_cntr" width="20%">' + girl_percent + '</td> ';
          tableStr += '<td class="txt_cntr" width="20%"> ' + boy_number + '</td>	';
          tableStr += '<td class="txt_cntr" width="20%"> ' + boy_percent + '</td>';
          tableStr += '</tr>';
        });
      } else {
        tableStr += '<tr><td class="txt_cntr" width="100%"  colspan="5"> No data found.</td></tr>';
      }

      tableStr += '</table>';
      $('#' + tblDiv).html(tableStr);
      // Check if population source data found.
      if (typeof AREA_JSON_DATA_OBJ['by_population_source'] !== 'undefined') {
        if (typeof AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceName'] !== 'undefined') {
          $('#ppl_source_nm').html(AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceName']);
        }

        if (typeof AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceTmPeriod'] !== 'undefined') {
          $('#ppl_tmprd').html(AREA_JSON_DATA_OBJ['by_population_source']['seriesData']['sourceTmPeriod']);
        }
      }

    }

    // Bar chart.
    function makeBarChart(graphDiv, selOpt)
    {
      if (graphDiv == 'graph_mrtl_status_adolescnt1') {
        barChartData = getChartXMLDataNode('graph_mrtl_status_adolescnt', selOpt, GRAPH_TYPE);
      } else {
        barChartData = getChartXMLDataNode(graphDiv, selOpt, GRAPH_TYPE);
      }
      // If bar chart data found properly.
      if (barChartData !== undefined && barChartData != '' && barChartData != null) {
        var xAxisCatg = barChartData.categoryData;
        var seriesData = barChartData.seriesData;
        var minVal = 0;
        var maxVal = null;
        var tickVal = 20;
        if (graphDiv == "graph_adolescnt_mrg") {
          // console.log(graphDiv);
          // console.log(barChartData);
          var SeriesName2 = barChartData.seriesData[0].name;
          var new_arr1 = new Array();
          for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
            var catg = barChartData.categoryData[i];
            var prevval = barChartData.seriesData[1].data[i];
            // seriesData[0].data[i] =seriesData[0].data[i]- seriesData[1].data[i];.
            seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
            new_arr1[catg] = prevval;
          }
        } else if (graphDiv == "graph_perc_mrd_female_used_or_not_contrcptn") {
          var SeriesName1 = barChartData.seriesData[1].name;
          var new_arr = new Array();
          /*for (i=0; i < barChartData.seriesData[2].data.length; i++)
           {
           var catg = barChartData.categoryData[i];
           var prevval = barChartData.seriesData[2].data[i];
           seriesData[1].data[i] =seriesData[1].data[i]- seriesData[2].data[i];
           new_arr[catg] = prevval;
           }*/
          if (selOpt == 'girl_15_19' && graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19 == false) {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[2].data[i];
              // seriesData[1].data[i] =seriesData[1].data[i]- seriesData[2].data[i];.
              seriesData[1].data[i] = {'y': seriesData[1].data[i] - seriesData[2].data[i], 'ry': seriesData[1].data[i]};
              new_arr[catg] = prevval;
            }
            graph_perc_mrd_female_used_or_not_contrcptn_girl_15_19 = true;
          } else if (selOpt == 'girl_20_24' && graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24 == false) {
            // If update series only first time, for option 'all_girl_15_19'.
            for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[2].data[i];
              seriesData[1].data[i] = {'y': seriesData[1].data[i] - seriesData[2].data[i], 'ry': seriesData[1].data[i]};
              new_arr[catg] = prevval;
              if (i == 0) {
              }
            }
            graph_perc_mrd_female_used_or_not_contrcptn_girl_20_24 = true;
          } else {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[2].data[i];
              new_arr[catg] = prevval;
            }

          }
        } else if (graphDiv == "graph_adolescnt_prg") {
          var SeriesName3 = barChartData.seriesData[0].name;
          var new_arr2 = new Array();
          for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
            var catg = barChartData.categoryData[i];
            var prevval = barChartData.seriesData[1].data[i];
            seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
            new_arr2[catg] = prevval;
          }
        } else if (graphDiv == "graph_perc_female_sexuly_active") {
          if (SEL_AREA_ID == "NPL" && selOpt == 'never-married_girl_15_19') {
            minVal = 0;
            maxVal = 10;
            tickVal = 1;
          }
          var SeriesName4 = barChartData.seriesData[0].name;
          var new_arr3 = new Array();
          // If update series only first time, for option 'never-married_girl_15_19'.
          if (selOpt == 'never-married_girl_15_19' && graph_perc_female_sexuly_active_married_girl_15_19 == false) {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[1].data[i];
              seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
              new_arr3[catg] = prevval;
            }
            graph_perc_female_sexuly_active_married_girl_15_19 = true;
          } else if (selOpt == 'all_girl_15_19' && graph_perc_female_sexuly_active_all_girl_15_19 == false) {
            // If update series only first time, for option 'all_girl_15_19'.
            for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[1].data[i];
              // seriesData[0].data[i] =seriesData[0].data[i]- seriesData[1].data[i];.
              seriesData[0].data[i] = {'y': seriesData[0].data[i] - seriesData[1].data[i], 'ry': seriesData[0].data[i]};
              new_arr3[catg] = prevval;
            }
            graph_perc_female_sexuly_active_all_girl_15_19 = true;
          } else {
            for (i = 0; i < barChartData.seriesData[1].data.length; i++) {
              var catg = barChartData.categoryData[i];
              var prevval = barChartData.seriesData[1].data[i];
              new_arr3[catg] = prevval;
            }
          }
        }

        var chartMarginBottom = barChartData.chartMarginBottom;
        var width = $(window).width();
        if (graphDiv == 'graph_part_resd_household_adolescnt' || graphDiv == 'graph_mrtl_status_adolescnt' || graphDiv == 'graph_adolescnt_prg' || graphDiv == 'graph_adolescnt_mrg' || graphDiv == 'graph_perc_female_sexuly_active' || graphDiv == 'graph_perc_age_diff_btwn_female_and_partnr' || graphDiv == 'graph_schl_atnd_adolescnt_male' || graphDiv == 'graph_schl_atnd_adolescnt_female') {

//          if (width > 930) {
//            width = 470;
//          } else if (width > 640 && width < 800) {
//            width = width / 2 - 20;
//          } else {
//            width = width - 30;
//          }
          width = 600;
          chartSettings = {
            renderTo: graphDiv,
            type: 'bar',
            width: width,
            marginBottom: chartMarginBottom,
            spacing: [0, 0, 10, 0]
          };
          // If xaxis found and its length is greater than 0 then set chart height.
          if (typeof xAxisCatg != 'undefined' && xAxisCatg.length > 0) {
            chartSettings['height'] = xAxisCatg.length * 22;
          }
        } else {
          if (width > 930) {
            // width = 310;
            width = 600;
            if (graphDiv == 'graph_perc_mrd_female_used_or_not_contrcptn' || graphDiv == 'graph_perc_female_contrcptn_dmnd_unmet' || graphDiv == 'graph_perc_female_contrcptn_dmnd_met' || graphDiv == 'graph_perc_wife_think_beating_jusfd' || graphDiv == 'graph_perc_female_take_contrcptn_desc_byself_or_with_hsbnd' || graphDiv == 'graph_perc_female_have_knwldg_hiv_aids') {
              //width = 330;
              width = 600;
            }
          }
//          else if (width > 640 && width < 800) {
//            width = width / 3 - 20;
//          } else {
//            width = width - 30;
//          }
          width = 600;
          if (graphDiv == 'graph_perc_mrd_female_used_or_not_contrcptn') {
            chartSettings = {
              renderTo: graphDiv,
              type: 'bar',
              width: width,
              height: 400,
              marginBottom: chartMarginBottom,
              spacing: [0, 0, 10, 0]
            };
          } else {
            chartSettings = {
              renderTo: graphDiv,
              type: 'bar',
              width: width,
              marginBottom: chartMarginBottom,
              spacing: [0, 0, 10, 0]
            };
          }
        }


        if (!barChartData.chartTtlFlg) {
          var barChartTtl = '';
        } else {
          var barChartTtl = barChartData.chartTitle;
        }
        var barXAxisLabel = barChartData.XAxisLabel;
        var barYAxisLabel = barChartData.YAxisLabel;
        var legendVisibility = barChartData.legendVisibility;
        var barGroupFlg = true;
        barGroupFlg = barChartData.groupFlg;
        if (barChartData.legendClick == 'true') {
          var legendClickFlag = true;
        } else {
          var legendClickFlag = false;
        }
        var errFlag = barChartData.errorStatus;
        if (errFlag == "true") {
          window[graphDiv] = " ";
          $("#" + graphDiv).html("Data not available").css({"text-align": "center", "margin": "50px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
        } else {
          window[graphDiv] = chart = new Highcharts.Chart({
            // window[graphDiv] = new Highcharts.Chart({.
            chart: chartSettings,
            credits: {
              enabled: false
            },
            exporting: {
              enabled: false,
              chartOptions: {
                chart: {
                  events: {
                    load: function () {
                      this.renderer.image('https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/UNFPA_logo.svg/2000px-UNFPA_logo.svg.png', 100, 100, 30, 30)
                        .add();
                    }
                  }
                }
              }
            },
            title: {
              text: '', //barChartTtl,
              style: {
                fontSize: CHART_TITLE_FONTSIZE,
                fontWeight: 'bold'
              }
            },
            xAxis: {
              categories: xAxisCatg,
              title: {
                text: barXAxisLabel,
              },
              labels: {
                style: {
                  width: 500,
                  fontSize: XAXIS_FONTSIZE
                }
              }
            },
            yAxis: {
              min: minVal,
              max: maxVal,
              tickInterval: tickVal,
              title: {
                align: 'low',
                text: barYAxisLabel, //null,
                style: {
                  fontSize: CHART_LABEL_FONTSIZE
                }
              },
              labels: {
                overflow: 'justify',
                formatter: function () {
                  return this.value;
                },
                style: {
                  fontSize: YAXIS_FONTSIZE
                }
              }
            },
            plotOptions: {
              series: {
                bar: {
                  grouping: barGroupFlg,
                  shadow: false
                },
                events: {
                  legendItemClick: function () {
                    return legendClickFlag;
                  },
                },
                dataLabels: {
                  enabled: true,
                  color: 'white',
                  overflow: 'justify',
                  formatter: function () {
                    return '';
                  },
                  style: {
                    fontSize: SERIES_ITEM_FONTSIZE
                  }
                },
                pointWidth: barChartData.pointWidth,
                // 'percent'// 'normal'.
                stacking: barChartData.stackVal
              }
            },
            tooltip: {
              /*positioner: function(boxWidth, boxHeight, point) {

               if(point.plotX>boxWidth)
               boxWidth2 = point.plotX - boxWidth;
               else
               boxWidth2 = point.plotX;
               //console.log('boxWidth--> '+boxWidth+' hght-->'+ boxHeight+ '  boxWidth22-->'+boxWidth22+point.toSource());
               return {x:boxWidth2,y:point.plotY};
               },*/
              borderRadius: 2,
              shadow: false,
              formatter: function () {
                // alert('hey');.
                if (this.series.name == SeriesName1) {
                  if (new_arr[this.x] != null) {
                    var plus = parseFloat(this.y) + parseFloat(new_arr[this.x]);
                  } else {
                    var plus = parseFloat(this.y);
                  }
                } else if (this.series.name == SeriesName2) {
                  if (new_arr1[this.x] != null) {
                    var plus = parseFloat(this.y) + parseFloat(new_arr1[this.x]);
                  } else {
                    var plus = parseFloat(this.y);
                  }

                } else if (this.series.name == SeriesName3) {
                  if (new_arr2[this.x] != null) {
                    var plus = parseFloat(this.y) + parseFloat(new_arr2[this.x]);
                  } else {
                    var plus = parseFloat(this.y);
                  }

                } else if (this.series.name == SeriesName4) {
                  if (new_arr3[this.x] != null) {
                    var plus = parseFloat(this.y) + parseFloat(new_arr3[this.x]);
                  } else {
                    var plus = parseFloat(this.y);
                  }

                } else {
                  var plus = parseFloat(this.y);
                }
                // Var plus =parseFloat(this.y);.
                return '<b>' + this.x + '</b><br>' + this.series.name + ' : ' + plus.toFixed(1) + '%';
              }
            },
            legend: {
              reversed: true,
              padding: 5,
              // layout: 'horizontal',
              // maxHeight:20,.
              shadow: false,
              enabled: legendVisibility,
              borderWidth: 0,
              borderRadius: 0,
              itemMarginTop: 2,
              itemMarginBottom: 2,
              symbolPadding: LEGENDITEM_SYMBOL_PADDING,
              symbolWidth: LEGENDITEM_SYMBOL_WIDTH,
              itemStyle: {
                fontSize: LEGENDITEM_FONTSIZE
              }
            },
            series: seriesData
          }, function (chart) {
            var extremes = this.yAxis[0].getExtremes();
            maxY = extremes.max;
            if (maxY > 100) {
              chart.yAxis[0].setExtremes(0, 100);
            }

            // Check if table container found then update table.
            containerParentDivID = $('#' + graphDiv).parent("div").attr('id');
            if ($('#' + containerParentDivID).find($('div.dfapi-visTbl-container')).length) {

              // call function to get object data in tabular format.
              tblContent = dfa_tableview.getDataTableContent('chart', chart, containerParentDivID, {title: {enabled: false}}, 'hosting');
              $('#' + containerParentDivID).append(tblContent);
            }
          }
          );
        }
      } else {
        window[graphDiv] = " ";
        $("#" + graphDiv).html("Data not available").css({"text-align": "center", "margin-top": "50px", "margin-bottom": "50px", "font-size": "26px", "font-weight": "normal", "color": "#a7a2ab"});
      }
    }

  });
})(jQuery);
